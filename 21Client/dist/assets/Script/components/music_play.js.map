{"version":3,"sources":["../../../../assets/Script/components/music_play.js"],"names":["cc","Class","extends","Component","onLoad","mp3Array","bgmUrl","bgm_on","sys","localStorage","getItem","effect_on","loadAllMp3","onLoadMp3Finish","bind","bindEvent","bindObj","push","onfire","on","MUSIC_ON_OFF","play_effect","onDestroy","audioEngine","stopMusic","i","length","un","bgm_on_off","effect_on_off","callback","self","loader","loadResDir","AudioClip","err","assets","urls","console","error","url","effectType","msg","bgm","playMusic","effect_name","loop","playEffect","stop_effect","effectID","stopEffect"],"mappings":"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","file":"music_play.js","sourcesContent":["cc.Class({\r\n    extends: cc.Component,\r\n\r\n    onLoad: function() {\r\n        this.mp3Array = [] //文件夹下的资源\r\n        this.bgmUrl = \"sound/sgj_bg1\" //背景音乐\r\n        this.bgm_on = (cc.sys.localStorage.getItem(\"bgm_on\") || \"true\") == \"true\"\r\n        this.effect_on = (cc.sys.localStorage.getItem(\"effect_on\") || \"true\") == \"true\"\r\n\r\n        //Notification.on(\"MUSIC_ON_OFF\", this.MUSIC_ON_OFF.bind(this), this)\r\n        this.loadAllMp3(this.onLoadMp3Finish.bind(this))\r\n        this.bindEvent()\r\n\r\n\r\n\r\n    },\r\n\r\n    bindEvent() {\r\n        this.bindObj = []\r\n        this.bindObj.push(onfire.on(\"MUSIC_ON_OFF\", this.MUSIC_ON_OFF.bind(this)))\r\n        this.bindObj.push(onfire.on(\"PLAY_MUSIC_EFFECT\", this.play_effect.bind(this)))\r\n    },\r\n\r\n\r\n    onDestroy: function() {\r\n        cc.audioEngine.stopMusic();\r\n        for (var i = 0; i < this.bindObj.length; i++) {\r\n            onfire.un(this.bindObj[i])\r\n        }\r\n    },\r\n\r\n\r\n\r\n    onLoadMp3Finish: function() {\r\n        this.bgm_on_off(this.bgm_on)\r\n        this.effect_on_off(this.effect_on)\r\n    },\r\n\r\n    //加载音频\r\n    loadAllMp3(callback) {\r\n\r\n        var self = this\r\n        // 加载 sound 目录下所有 AudioClip，并且获取它们的路径\r\n        cc.loader.loadResDir(\"sound\", cc.AudioClip, function(err, assets, urls) {\r\n            if (err) {\r\n                console.error(\"加载错误\")\r\n                return\r\n            }\r\n            for (var i = 0; i < urls.length; i++) {\r\n                var url = urls[i]\r\n                self.mp3Array[url] = assets[i]\r\n\r\n            }\r\n            callback()\r\n        });\r\n    },\r\n\r\n\r\n    //当系统音效开关点击时候触发\r\n    MUSIC_ON_OFF: function(effectType, msg) {\r\n\r\n        if (effectType == \"bgm\") { //bgm\r\n            var bgm_on = msg\r\n            this.bgm_on_off(msg)\r\n        }\r\n        if (effectType == \"effect\") { // 音效\r\n            var effect_on = msg\r\n            this.effect_on_off(effect_on)\r\n        }\r\n    },\r\n\r\n\r\n    //bgm开关\r\n    bgm_on_off: function(on) {\r\n        if (on) {\r\n            var bgm = this.mp3Array[this.bgmUrl]\r\n            if (bgm) {\r\n                cc.audioEngine.playMusic(bgm, true);\r\n            }\r\n\r\n        } else {\r\n            cc.audioEngine.stopMusic();\r\n        }\r\n    },\r\n\r\n    //音效开关\r\n    effect_on_off: function(effect_on) {\r\n        this.effect_on = effect_on\r\n    },\r\n\r\n    //播放音效 返回effectID\r\n    play_effect: function(effect_name, loop) {\r\n\r\n        if (!this.effect_on) { //音效静音\r\n            return\r\n        }\r\n\r\n        if (this.mp3Array[effect_name]) {\r\n            loop = loop || false\r\n            return cc.audioEngine.playEffect(this.mp3Array[effect_name], loop);\r\n        } else {\r\n            console.error(\"你要播放的音效不存在：\", effect_name)\r\n        }\r\n    },\r\n    stop_effect: function(effectID) {\r\n        cc.audioEngine.stopEffect(effectID);\r\n    },\r\n\r\n\r\n});"]}