{"version":3,"sources":["../../../../assets/Script/components/CardBoxSprite.js"],"names":["CardSprite","require","RANK_21","cc","Class","extends","Component","properties","Allsprite","default","type","SpriteAtlas","onLoad","POINT_IN","p","POINT_OUT","_rank","_rankLa","_rankBgSpr","_cardData","_cards","_arrowSpr","_result","_armature","loadInfo","initMembers","loadRankLabel","loadArrowSpr","loadCards","cardData","isDeal","baseCards","result","i","len","length","cardSpr","cardMaker","num","blackJackJudge","setTimeout","orderCards","updateContents","updatePosition","bind","rankBgSpr","node","getChildByName","active","rankLab","getComponent","Label","_rankLab","positionA","getPosition","positionB","y","runAction","repeatForever","sequence","moveTo","loadArmature","scale","armatureName","animationName","loop","isBlackJack","isFiveDragon","isBust","Util","playAnimation","to","qscale","delayMove","targetArr","targetP","cardScript","cardImg","_img","addCardNode","addChild","cardMove","push","img","Node","setScale","CardSpr","addComponent","Sprite","spriteFrame","getSpriteFrame","addDoubleTip","updateCards","data","card","delayTime","callFunc","isDouble","curCards","visible","ranks","rankStr","snd","setRankStr","setSprVisible","setRankSprSprite","string","spr","setArrowVisible","spriteImg","index","lastCardSpr","x","getPositionX","showOnlyRank","showCard","splice","scaleTo","newCardSpr","removeFromParent","moveBy","deleteSelf","convertToNodeSpace","loadTexture","ccui","Widget","PLIST_TEXTURE","rotate","spawn","rotateBy","lenI","selfSize","getContentSize","mult","intervalX","originX","width","setPosition"],"mappings":"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","file":"CardBoxSprite.js","sourcesContent":["// Learn cc.Class:\r\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/class.html\r\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/class.html\r\n// Learn Attribute:\r\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\r\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/reference/attributes.html\r\n// Learn life-cycle callbacks:\r\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\r\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/life-cycle-callbacks.html\r\nvar CardSprite = require('CardSprite')\r\nvar RANK_21 = require('Config').RANK_21\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        Allsprite:{\r\n            default:null,\r\n            type:cc.SpriteAtlas\r\n        }\r\n    },\r\n\r\n    onLoad:function(){\r\n// 成员变量\r\n        this.POINT_IN = cc.p(950, 650),\r\n        this.POINT_OUT= cc.p(350, 650),\r\n        this._rank = 0           // 卡牌点数\r\n        this._rankLa =  null     // 点数标签\r\n        this._rankBgSpr = null   // 点数背景\r\n        this._cardData = {}     // 卡牌数据\r\n        this._cards = []         // 存储卡牌\r\n        this._arrowSpr = null    // 箭头精灵\r\n        this._result = {}       //\r\n        this._armature = null    // 骨骼动画\r\n\r\n    },\r\n// 构造函数\r\n    loadInfo: function(){\r\n        // 初始化成员变量\r\n        this.initMembers();\r\n        // 加载点数标签\r\n        this.loadRankLabel();\r\n        // 加载箭头\r\n        this.loadArrowSpr();\r\n    },\r\n\r\n    // 初始化成员变量\r\n    initMembers: function(){\r\n        this._cardData = {};\r\n        this._result = {};\r\n        this._cards = [];\r\n    },\r\n    /*\r\n    * 界面渲染\r\n    * */\r\n    // 加载卡牌\r\n    loadCards: function(cardData, isDeal){\r\n        this._cardData = cardData;\r\n        var baseCards = cardData.baseCards;\r\n        var result = cardData.result;\r\n\r\n        for (var i = 0, len = baseCards.length; i < len; i++) {\r\n            var cardData = baseCards[i];\r\n            var cardSpr = this.cardMaker(cardData, 0.25 * i);\r\n\r\n            if (i == len - 1) {\r\n                if (baseCards[0].num >= 10 && isDeal) {\r\n                    this.blackJackJudge(cardSpr);\r\n                }\r\n\r\n                setTimeout(function(){\r\n                        this.orderCards();\r\n                        // 更新点数等内容\r\n                        this.updateContents(result);\r\n                        // 调整点数标签的位置\r\n                        this.updatePosition();\r\n                }.bind(this), 250 * i + 900);\r\n            }\r\n        }\r\n    },\r\n\r\n    // 加载点数标签\r\n    loadRankLabel: function(){\r\n        var rankBgSpr = this.node.getChildByName('21dian-rankTipBg1');\r\n        rankBgSpr.active = false;\r\n        var rankLab = rankBgSpr.getChildByName('card_num').getComponent(cc.Label)\r\n        this._rankBgSpr = rankBgSpr;\r\n        this._rankLab = rankLab;\r\n    },\r\n\r\n    // 加载箭头\r\n    loadArrowSpr: function(){\r\n        this._arrowSpr = this.node.getChildByName('21dian-arrowTip');\r\n        // this._arrowSpr = new cc.Sprite(\"#21dian/arrowTip.png\").to(this, 9).p(20, 70).hide();\r\n        this._arrowSpr.active = false;\r\n        var positionA = this._arrowSpr.getPosition()\r\n        var positionB = this._arrowSpr.getPosition()\r\n        positionB.y +=15;\r\n        this._arrowSpr.runAction(cc.repeatForever(\r\n            cc.sequence(\r\n                cc.moveTo(0.5, positionB),\r\n                cc.moveTo(0.5, positionA)\r\n            )\r\n        ));\r\n    },\r\n\r\n    // 加载骨骼动画\r\n    loadArmature: function(result){\r\n        var scale = 1.0;\r\n        var p = cc.p(0, -40);\r\n        var armatureName = \"\";  // BaoPai, WuXiaoLong, HeiJieKe\r\n        var animationName = \"loop\";\r\n        var loop = 1;\r\n\r\n        if (result.isBlackJack) {\r\n            scale = 1.0;\r\n            armatureName = \"HeiJieKe\";\r\n        } else if (result.isFiveDragon) {\r\n            scale = 0.5;\r\n            armatureName = \"WuXiaoLong\";\r\n        } else if (result.isBust) {\r\n            loop = -1;\r\n            p = cc.p(0, 0);\r\n            armatureName = \"BaoPai\";\r\n            animationName = \"play\";\r\n        }\r\n\r\n        // 播放牌型提示动画\r\n        if (armatureName) {\r\n            this._armature = Util.playAnimation(armatureName, animationName, null, loop, 0)\r\n                .to(this).p(p).qscale(scale);\r\n        }\r\n    },\r\n\r\n    // 卡牌构造器\r\n    cardMaker: function(cardData, delayMove){\r\n        var targetArr = this._cards;\r\n        var targetP = cc.p(targetArr.length * 25, 0);\r\n        var cardScript = new CardSprite(cardData);\r\n        var cardImg = cardScript._img;\r\n        var cardSpr = this.addCardNode(cardImg);\r\n        this.node.addChild(cardSpr)\r\n        // 卡片移动\r\n        this.cardMove(cardSpr, targetP, delayMove, 1.0, 360);\r\n        targetArr.push(cardSpr);\r\n        return cardSpr;\r\n    },\r\n    //增加一个牌的节点\r\n    addCardNode:function(img){\r\n        var node = new cc.Node(img)\r\n        node.setScale(0.1);\r\n        //调用新建的node的addComponent函数，会返回一个sprite的对象\r\n        var CardSpr = node.addComponent(cc.Sprite)\r\n        CardSpr.spriteFrame = this.Allsprite.getSpriteFrame(img);\r\n        //把新的节点追加到self.node节点去。self.node，就是脚本挂载的节点\r\n        return node;\r\n    },\r\n    //增加一个节点\r\n    addDoubleTip:function (img) {\r\n        var node = new cc.Node(img)\r\n\r\n        //调用新建的node的addComponent函数，会返回一个sprite的对象\r\n        var CardSpr = node.addComponent(cc.Sprite)\r\n        CardSpr.spriteFrame = this.Allsprite.getSpriteFrame(img);\r\n        //把新的节点追加到self.node节点去。self.node，就是脚本挂载的节点\r\n        return node;\r\n    },\r\n    /*\r\n    * 逻辑处理\r\n    * */\r\n    // 更新卡牌信息\r\n    updateCards: function(data) {\r\n        // data: {selfKey: ,userID: ,card: ,canDouble: ,canSplit: ,isDouble: ,curCards: ,score:}\r\n        var cardSpr = this.cardMaker(data.card, 0.0);\r\n\r\n        this.runAction(cc.sequence(\r\n            cc.delayTime(0.6),\r\n            cc.callFunc(function(){\r\n                data.isDouble && cardSpr.addChild(this.addDoubleTip('21dian-doubleTip'));\r\n                // 更新点数等内容\r\n                this.updateContents(data.curCards.result);\r\n                // 排列卡牌\r\n                this.orderCards();\r\n                // 调整点数标签的位置\r\n                this.updatePosition();\r\n            }.bind(this))\r\n        ));\r\n        this._result = data.result;\r\n    },\r\n\r\n    // 更新点数等内容\r\n    updateContents: function(result){\r\n        var visible = true;\r\n        var img = \"21dian-rankTipBg1\";\r\n        var ranks = result.ranks;\r\n        var rankStr = ranks[0];\r\n        var snd = \"\";\r\n\r\n        if (result.isBlackJack) {\r\n            visible = false;\r\n            snd = \"card_hjk.mp3\";\r\n        } else if (result.isFiveDragon) {\r\n            visible = false;\r\n            snd = \"card_wxl.mp3\";\r\n            this._arrowSpr.active = false;\r\n        } else if (result.isBust) {\r\n            visible = true;\r\n            rankStr = \"爆牌\";\r\n            img = \"21dian/bustTipBg.png\";\r\n            snd = \"Bust.mp3\";\r\n            this._arrowSpr.active = false;\r\n        } else {\r\n            if (ranks.length > 1) {\r\n                rankStr += \"/\" + ranks[1];\r\n                img = \"21dian-rankTipBg2\";\r\n            }\r\n            snd = (ranks[0] == RANK_21 || ranks[1] == RANK_21) ? \"21.mp3\" : snd;\r\n        }\r\n        // 加载骨骼动画\r\n        // this.loadArmature(result);\r\n        this._rankLab &&  this.setRankStr(rankStr);\r\n        this._rankBgSpr && this.setSprVisible(this._rankBgSpr,visible);\r\n        this._rankBgSpr && this.setRankSprSprite(img);\r\n\r\n        // var path = \"res/21dian/sound/\" + snd;\r\n        //\r\n        // if(snd != \"\")\r\n        //     SoundEngine.playEffect(path);\r\n    },\r\n    //设置点数内容\r\n    setRankStr:function(rankStr){\r\n        this._rankLab.string = rankStr;\r\n        this._rankBgSpr.active = true\r\n    },\r\n    //设置可见性\r\n    setSprVisible:function (spr,visible) {\r\n        spr.active = visible\r\n    },\r\n    // 设置箭头的可见性\r\n    setArrowVisible: function(visible){\r\n        this._arrowSpr.active = visible;\r\n    },\r\n\r\n    //更新点数的背景图\r\n    setRankSprSprite:function(img){\r\n        var spriteImg = this._rankBgSpr.getComponent(cc.Sprite);\r\n        spriteImg.spriteFrame = this.Allsprite.getSpriteFrame(img);\r\n    },\r\n    // 更新箭头的位置\r\n    updatePosition: function(){\r\n        var index = this._cards.length - 1;\r\n        var lastCardSpr = this._cards[index];\r\n        var x = lastCardSpr.getPositionX();\r\n\r\n        this._rankBgSpr.x = x + 12\r\n        this._arrowSpr.x = x + 5;\r\n\r\n    },\r\n\r\n    // 显示唯一的点数\r\n    showOnlyRank: function(curCards){\r\n        var result = curCards.result;\r\n        // 只有有两个点数的才需要最终显示一个点数\r\n        if (result.ranks.length >= 2) {\r\n            result.ranks = [result.ranks[0]];\r\n            // 更新内容\r\n            this.updateContents(result);\r\n            // 更新位置\r\n            this.updatePosition();\r\n        }\r\n    },\r\n\r\n    // 亮牌x\r\n    showCard: function(data){\r\n        var card = data.card;\r\n        var cardSpr = this._cards.splice(1, 1)[0];\r\n\r\n        cardSpr.runAction(cc.sequence(\r\n            cc.scaleTo(0.25, 0, 1),\r\n            cc.callFunc(function(){\r\n                var p = cardSpr.getPosition();\r\n                var newCardSpr = new CardSprite(card).to(this).p(p).qscale(0, 1);\r\n\r\n                newCardSpr.runAction(cc.sequence(\r\n                    cc.scaleTo(0.25, 1),\r\n                    cc.callFunc(function(){\r\n                        // 更新点数等内容\r\n                        this.updateContents(data.curCards.result);\r\n                        // 排列卡牌\r\n                        this.orderCards();\r\n                        // 调整点数标签的位置\r\n                        this.updatePosition();\r\n                    }.bind(this))\r\n                ));\r\n\r\n                cardSpr.removeFromParent();\r\n                this._cards.push(newCardSpr);\r\n\r\n            }.bind(this))\r\n        ));\r\n    },\r\n\r\n\r\n\r\n    blackJackJudge: function(cardSpr){\r\n        cardSpr.runAction(cc.sequence(\r\n            cc.delayTime(1.5),\r\n            cc.moveBy(0.1, cc.p(0, 20)),\r\n            cc.delayTime(1.0),\r\n            cc.moveBy(0.1, cc.p(0, -20))\r\n        ));\r\n    },\r\n\r\n    // 卡牌移走\r\n    deleteSelf: function(){\r\n        for (var i = this._cards.length - 1; i >= 0; i--) {\r\n            var p = this.convertToNodeSpace(this.POINT_OUT);\r\n            var cardSpr = this._cards.splice(i, 1)[0];\r\n\r\n            cardSpr.loadTexture(\"21dian/pkp_bm.png\", ccui.Widget.PLIST_TEXTURE);\r\n            this.cardMove(cardSpr, p, 0, 0, 0);\r\n\r\n            this.runAction(cc.sequence(\r\n                cc.delayTime(1.0),\r\n                cc.callFunc(function(){\r\n                    this.removeFromParent();\r\n                }.bind(this))\r\n            ))\r\n        }\r\n        this._armature && this._armature.removeFromParent();\r\n        this._rankBgSpr && this._rankBgSpr.removeFromParent();\r\n        this._arrowSpr && this._arrowSpr.removeFromParent();\r\n    },\r\n\r\n    // 卡牌移动.\r\n    cardMove: function(cardSpr, targetP, delayMove, scale, rotate){\r\n        cardSpr.runAction(cc.sequence(\r\n            cc.delayTime(delayMove),\r\n            // cc.callFunc(function(){\r\n            //     SoundEngine.playEffect(\"res/21dian/sound/DealPoker.mp3\");\r\n            // }.bind(this)),\r\n            cc.spawn(\r\n                cc.scaleTo(0.5, scale),\r\n                cc.moveTo(0.5, targetP),\r\n                cc.rotateBy(0.5, rotate)\r\n            )\r\n        ));\r\n    },\r\n\r\n    // 排列卡牌\r\n    orderCards: function(){\r\n        for (var i = 0, lenI = this._cards.length; i < lenI; i++) {\r\n            var cardSpr = this._cards[i];\r\n            var selfSize = this.node.getContentSize();\r\n            var mult = lenI / 2 - 0.5;\r\n            var intervalX = 28;\r\n\r\n            var originX = selfSize.width * 0.5 - intervalX * mult;\r\n            var p = cc.p(originX + i * intervalX, 0);\r\n\r\n            cardSpr.setPosition(p);\r\n        }\r\n    },\r\n    // update (dt) {},\r\n});\r\n"]}