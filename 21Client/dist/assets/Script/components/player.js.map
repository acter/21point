{"version":3,"sources":["../../../../assets/Script/components/player.js"],"names":["playerTypes","require","playerType","Util","cc","Class","extends","Component","properties","onLoad","isReadyEnd","MAX_TIME","_baseBet","betNum","spriteFrames","buyInsuranceFlagSpr","progressTimer","betNumSpr","_cardBoxes","_betSprites","insuranceBets","isPlaying","initNodes","loadProgressTimer","loadInfo","data","allSprites","initMembers","type","TYPE_DEALER","loadFace","loadPlayInfo","onWagerHandler","playerBgNode","opacity","node","getChildByName","headImgNode","headImageNode","bet_numNode","player_nameNode","goldNode","cardNode","coinNode","tipNode","playerBg","headImg","headImage","getComponent","Label","string","_data","nickname","score","Sprite","spriteFrame","getSpriteFrame","_scoreLab","showTip","active","action1","scaleTo","action2","finished","callFunc","isShowTip","action3","sequence","repeat","runAction","progress","proTimer","_jindutiaotime","time","self","scheduleOnce","fillRange","onfire","fire","hideProgressTimer","bind","showProgressTimer","percent","_betNum","setBaseBet","onPlayerInHandler","myUserItem","GD","clientKernel","userID","chairID","point","PLAYER_POINTS","playerSpr","PlayerSprite","to","p","players","arr","iteration","left","intNum","base","bets","i","length","Math","floor","j","Node","setScale","betSpr","addComponent","_spriteFrames","addChild","setPosition","center","rad","random","PI","x","cos","y","sin","delayTime","moveTo","push","loadBet","setUserScore","onHitHandler","isDealer","boxKey","selfKey","result","curCards","curCardBox","updateCards","isDouble","setHitTipVisible","showOnlyRank","baseBet","isBust","coinMove","onBuyInsuranceHandler","_insuranceBets","num","img","numImg","coinBgSpr","coinNum","loader","loadRes","BitmapFont","err","bitmapFont","font","numberTran","setCascadeOpacityEnabled","spawn","moveBy","fadeOut","loadCardBoxes","cardData","dealID","len","cardBoxSpr","isDeal","getUserID","loadCards","targetKey","visible","key","setArrowVisible","reset","cardBox","deleteSelf","splice","removeFromParent","removeBetNumSpr","_isPlaying","getCurScore","parseInt","setIsPlaying","flag"],"mappings":"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","file":"player.js","sourcesContent":["var playerTypes = require('define').playerType;\r\nvar Util = require('Util');\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n\r\n    },\r\n\r\n    onLoad: function() {\r\n        this.isReadyEnd = false;\r\n        this.MAX_TIME = 10;\r\n        this._baseBet = 0;\r\n        this.betNum = 0;\r\n        this.spriteFrames = null;//游戏所需的图片资源\r\n        this.buyInsuranceFlagSpr = null;\r\n        this.progressTimer = null;\r\n        this.betNumSpr = null;\r\n        this._cardBoxes = {};\r\n        this._betSprites = [];\r\n        this.insuranceBets = [];\r\n        this.isPlaying = false;\r\n        this.initNodes();\r\n        this.loadProgressTimer()\r\n\r\n    },\r\n    //加载用户数据\r\n    loadInfo(data,allSprites){\r\n        this.initMembers(data)\r\n        this.spriteFrames = allSprites;\r\n        if (data.type != playerTypes.TYPE_DEALER) {\r\n            // 加载头像\r\n            this.loadFace();\r\n            // 加载玩家信息\r\n            this.loadPlayInfo()\r\n            // 加载购买了保险的提示\r\n            // this.loadBuyInsuranceFlagSprite();\r\n            // 加载时间进度条\r\n            this.loadProgressTimer();\r\n            // 加载筹码\r\n            this.onWagerHandler(data);\r\n        } else {\r\n            this.playerBgNode.opacity = 0;\r\n        }\r\n    },\r\n    //加载节点\r\n    initNodes(){\r\n        this.playerBgNode =  this.node.getChildByName('21dian-playerBg');\r\n        this.headImgNode =  this.playerBgNode.getChildByName('head-image');\r\n        this.headImageNode = this.headImgNode.getChildByName('headimg');\r\n        this.bet_numNode = this.playerBgNode.getChildByName('bet_num');\r\n        this.player_nameNode = this.playerBgNode.getChildByName('player-name');\r\n        this.goldNode =  this.playerBgNode.getChildByName('gold');\r\n        this.cardNode = this.node.getChildByName('card');\r\n        this.coinNode = this.node.getChildByName('gold')\r\n        this.tipNode = this.node.getChildByName('tip');\r\n    },\r\n    // 加载头像\r\n    loadFace() {\r\n        this.playerBg = this.node.getChildByName('21dian-playerBg');\r\n        this.headImg =  this.playerBg.getChildByName('head-image');\r\n        this.headImage = this.headImg.getChildByName('headimg');\r\n         // this.headImage.getComponent(cc.Sprite).spriteFrame = this.spriteFrames.getSpriteFrame('21dian-playerBg')\r\n    },\r\n    //加载玩家信息\r\n    loadPlayInfo(){\r\n        this.player_nameNode.getComponent(cc.Label).string = this._data.nickname;\r\n        this.goldNode.getComponent(cc.Label).string = this._data.score;\r\n        this.playerBg.getComponent(cc.Sprite).spriteFrame = this.spriteFrames.getSpriteFrame('21dian-playerBg');\r\n        // var self = this;\r\n        // cc.loader.loadRes(\"game\", cc.SpriteAtlas, function (err, atlas) {\r\n        //     self.playerBg.getComponent(cc.Sprite).spriteFrame = atlas.getSpriteFrame('21dian-playerBg');\r\n        // });\r\n        this._scoreLab = this.goldNode.getComponent(cc.Label);\r\n    },\r\n\r\n    //提示位置\r\n    showTip(){\r\n        this.tipNode.active = true;\r\n        var action1 = cc.scaleTo(0.2, 1.2, 1.2);\r\n        var  action2= cc.scaleTo(0.2, 1, 1);\r\n\r\n        var finished = cc.callFunc(function () {\r\n            this.tipNode.active = false; this.isShowTip = true;\r\n        }, this)\r\n        var action3 = cc.sequence(cc.sequence(action1, action2).repeat(5),finished)\r\n        // var callFunc = cc.callFunc(this.playertip.active,false)\r\n        this.tipNode.runAction(action3);// right\r\n\r\n    },\r\n\r\n    // 加载时间进度条\r\n    loadProgressTimer(){\r\n        this.progress = this.playerBgNode.getChildByName('21dian-ui_pk_bjdt');\r\n        this.progress.active = false;\r\n        var proTimer = this.progress.getComponent(cc.Sprite)\r\n        this.progressTimer = proTimer;\r\n    },\r\n    _jindutiaotime:function(time){\r\n        var self = this\r\n        if(time > 0){\r\n            this.scheduleOnce(function() {\r\n                // cc.log(time)\r\n                this.progressTimer.fillRange = time / (this.MAX_TIME * 1000);\r\n                time =  time - 10;\r\n                self._jindutiaotime(time)\r\n            }, 0.01);\r\n        }\r\n        else {\r\n            this.progress.active = false\r\n            onfire.fire('readyEnd',this.hideProgressTimer.bind(this));\r\n        }\r\n    },\r\n// 显示进度条\r\n    showProgressTimer(time){\r\n        time = time || this.MAX_TIME;\r\n        var percent = time / this.MAX_TIME * 100;\r\n        if (this.progressTimer) {\r\n            this.progress.active = true;\r\n        } else {\r\n            this.loadProgressTimer();\r\n        }\r\n        this.progressTimer.fillRange = percent;\r\n        this._jindutiaotime(time)\r\n    },\r\n    // 隐藏进度条\r\n    hideProgressTimer(){\r\n        this.progressTimer && (this.progress.active = false);\r\n    },\r\n\r\n    // 初始化成员变量\r\n    initMembers: function(data){\r\n        this._data = data;\r\n        this._betNum = 0;\r\n        this._cardBoxes = {};\r\n        this._betSprites = [];\r\n    },\r\n    // 设置底注\r\n    setBaseBet: function(betNum){\r\n        this._baseBet = betNum;\r\n    },\r\n    // 其他玩家进场的处理函数\r\n    onPlayerInHandler(data){\r\n        var myUserItem = GD.clientKernel.myUserItem;\r\n        if (myUserItem.userID == data.userID) return;\r\n\r\n        var chairID = data.chairID;\r\n        var point = this.PLAYER_POINTS[chairID];\r\n        var playerSpr = new PlayerSprite(data).to(this).p(point);\r\n\r\n        this.players[chairID] = playerSpr;\r\n    },\r\n    // 下注的处理函数\r\n    onWagerHandler: function(data, arr){\r\n        var betNum = data.betNum;\r\n        var score = data.score;\r\n        arr = arr || this._betSprites;\r\n        var self = this;\r\n        var iteration = function(betNum, arr){\r\n            var left = 0;\r\n            var intNum = 0;\r\n            var base = 1;\r\n            var bets = [10, 100, 1000, 10000, 100000, 1000000];\r\n\r\n            for (var i = bets.length - 1; i >= 0; i--) {\r\n                base = bets[i];\r\n                if (betNum >= base) {\r\n                    intNum = Math.floor(betNum / base);\r\n                    left = betNum - intNum * base;\r\n                    break;\r\n                }\r\n            }\r\n                for (var j = 0; j < intNum; j++) {\r\n                    //创建一个新的节点，因为cc.Sprite是组件不能直接挂载到节点上，只能添加到为节点的一个组件\r\n                    var node = new cc.Node('21dian-coin_'+base)\r\n                    node.setScale(0.5,0.5);\r\n                    //调用新建的node的addComponent函数，会返回一个sprite的对象\r\n                    var betSpr = node.addComponent(cc.Sprite)\r\n\r\n                    betSpr.spriteFrame = self.spriteFrames._spriteFrames['21dian-coin_'+base]\r\n                    //把新的节点追加到self.node节点去。self.node，就是脚本挂载的节点\r\n                    this.coinNode.addChild(node);\r\n                    node.setPosition(0,-200);\r\n                    (function(node, j){\r\n                        var center = cc.p(0, 0);\r\n                        var rad = Math.random() * 2 * Math.PI;\r\n                        var x = center.x + 50 * Math.cos(rad) * Math.random();\r\n                        var y = center.y + 50 * Math.sin(rad) * Math.random();\r\n                        node.runAction(cc.sequence(\r\n                            cc.delayTime(0.2 * j),\r\n                            cc.moveTo(0.2, cc.p(x, y))\r\n                        ));\r\n                    })(node, j);\r\n\r\n                    arr.push(node);\r\n                }\r\n\r\n            if (left > 10) return iteration(left, arr);\r\n        }.bind(this);\r\n\r\n        // 开始迭代下金币\r\n        betNum && iteration(betNum - this._betNum, arr);\r\n        // 更新筹码\r\n        betNum && this.loadBet(betNum);\r\n        // 更新分数\r\n        this.setUserScore(score)\r\n    },\r\n    // 要牌的处理函数\r\n    onHitHandler: function(data, isDealer){\r\n        // data: {selfKey: ,userID: ,card: ,canDouble: ,canSplit: ,isDouble: ,curCards: ,score:\r\n        // cardLeftNum: ,baseBet: }\r\n        var boxKey = data.selfKey;\r\n        var result = data.curCards.result;\r\n        var curCardBox = this._cardBoxes[boxKey];\r\n        // 更新卡牌信息\r\n        curCardBox.updateCards(data);\r\n\r\n        // 加倍,要多下一份注\r\n        if (data.isDouble) {\r\n            this.setHitTipVisible(null, false);\r\n            this.showOnlyRank(data.curCards);\r\n            this.onWagerHandler({\r\n                betNum: this._betNum + data.baseBet,\r\n                score: data.score\r\n            });\r\n            this.hideProgressTimer();\r\n        } else if (result.isBust && !isDealer) {\r\n            // 庄家爆牌则不需要做这一步\r\n            this.runAction(cc.sequence(\r\n                cc.delayTime(0.5),\r\n                cc.callFunc(function(){\r\n                    var betNum = this._betNum - data.baseBet;\r\n                    // 下注数更新\r\n                    this.loadBet(betNum);\r\n                    // 金币移动\r\n                    this.coinMove(-data.baseBet);\r\n                }.bind(this))\r\n            ));\r\n            this.hideProgressTimer();\r\n        } else {\r\n            this.showProgressTimer();\r\n        }\r\n    },\r\n    // 买保险的处理函数\r\n    onBuyInsuranceHandler: function(data){\r\n        this._insuranceBets = [];\r\n        this.onWagerHandler({\r\n            betNum: this._betNum + data.betNum,\r\n            score: data.score\r\n        }, this._insuranceBets);\r\n    },\r\n    // 金币移动\r\n    coinMove: function(num){\r\n        var img = num > 0 ? \"21dian-winCoinBg\" : \"21dian-lostCoinBg\";\r\n        var numImg = num > 0 ? \"shuzi003\" : \"shuzi004\";\r\n        var coinNode = this.node.getChildByName('21dian-winCoinBg')\r\n        var coinBgSpr = coinNode.getComponent(cc.Sprite);\r\n        coinBgSpr.spriteFrame = this.spriteFrames.getSpriteFrame(img)\r\n      //替换的label节点的字体\r\n        var coinNum = coinNode.getChildByName('winGold')\r\n//字体资源\r\n        cc.loader.loadRes(\"game/\"+numImg, cc.BitmapFont, function (err, bitmapFont) {\r\n            coinNum.getComponent(cc.Label).font = bitmapFont;\r\n        });\r\n        coinNum.getComponent(cc.Label).string = Util.numberTran(num)\r\n        // coinNum.getComponent(cc.Label).font =\r\n        //节点的不透明度值是否影响其子节点\r\n        coinNode.setCascadeOpacityEnabled(true);\r\n        coinNode.runAction(cc.spawn(\r\n            cc.moveBy(1.0, cc.p(0, 100)),\r\n            cc.sequence(\r\n                cc.delayTime(0.5),\r\n                cc.fadeOut(0.5),\r\n                cc.callFunc(function(){\r\n                    coinNode.active = 0;\r\n                }.bind(this))\r\n            )\r\n        ));\r\n    },\r\n    // 加载筹码\r\n    loadBet: function(betNum){\r\n        if (betNum != 0) {\r\n            this.bet_numNode.active = true;\r\n            this.bet_numNode.getComponent(cc.Label).string = Util.numberTran(betNum)\r\n        } else {\r\n            this.bet_numNode.active = false;\r\n        }\r\n        this._betNum = betNum;\r\n    },\r\n    // 加载套牌\r\n    loadCardBoxes: function(cardData, dealID){\r\n        for (var i = 0, len = cardData.length; i < len; i++) {\r\n            var data = cardData[i];\r\n            var cardBoxSpr = this.cardNode.getComponent('CardBoxSprite');\r\n            cardBoxSpr.loadInfo();\r\n            var isDeal = dealID == this.getUserID();\r\n            cardBoxSpr.loadCards(data, isDeal);\r\n            this._cardBoxes[data.selfKey] = cardBoxSpr;\r\n        }\r\n    },\r\n    // 显示要牌的箭头提示\r\n    setHitTipVisible: function(targetKey, visible){\r\n        for (var key in this._cardBoxes) {\r\n            this._cardBoxes[key].setArrowVisible(false);\r\n        }\r\n\r\n        if (visible) {\r\n            this._cardBoxes[targetKey].setArrowVisible(visible);\r\n            !this.isDealer() && this.showProgressTimer();\r\n        }\r\n    },\r\n    reset(){\r\n        for (var key in this._cardBoxes) {\r\n            var cardBox = this._cardBoxes[key];\r\n            cardBox.deleteSelf();\r\n            delete this._cardBoxes[key];\r\n        }\r\n\r\n        for (var j = this._betSprites.length - 1; j >= 0; j--) {\r\n            var betSpr = this._betSprites.splice(j, 1)[0];\r\n            betSpr.removeFromParent();\r\n        }\r\n        // 移除下注的筹码精灵\r\n        this.removeBetNumSpr();\r\n        this._betNum = 0;\r\n        this._isPlaying = false;\r\n        this._betSprites = [];\r\n        this._cardBoxes = {};\r\n    },\r\n    // 是否是庄家\r\n    isDealer(){\r\n        return this._data.isDealer;\r\n    },\r\n    // 获取用户ID\r\n    getUserID(){\r\n        return this._data.userID;\r\n    },\r\n    getCurScore: function(){\r\n        return parseInt(this._scoreLab.string);\r\n    },\r\n    //更改玩家分数\r\n    setUserScore(score){\r\n\r\n        this._scoreLab.string = score;\r\n        return\r\n    },\r\n    //设置玩家是否在玩状态\r\n    setIsPlaying: function(flag){\r\n        this._isPlaying = flag;\r\n    },\r\n});"]}