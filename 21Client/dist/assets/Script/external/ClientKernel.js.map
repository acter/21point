{"version":3,"sources":["../../../../assets/Script/external/ClientKernel.js"],"names":["NetHelp","require","GD","define","GameUserManager","gameCMD","gameConst","ClientKernel","cc","Class","properties","gameUserManager","gameStatus","myUserItem","myUserID","serverReady","clientReady","tableSetting","ctor","init","userID","onfire","on","onEventMessage","bind","getUserMgr","getTableSetting","webSocketSend","data","roomID","sendGameMessage","MDM_GR_LOGON","onSocketMainLogon","MDM_GR_USER","onSocketMainUser","MDM_GF_GAME","onSocketMainGame","MDM_GF_FRAME","onSocketMainFrame","subCMD","SUB_GR_LOGON_SUCCESS","gameConfig","getUserByUserID","console","log","loginSuccess","onReady","fire","onClientReady","onEventSelfEnter","mainCMD","SUB_GF_GAME_OPTION","onUserItemActive","userItem","i","tableUserItem","length","getRoomInfo","chat","text","SUB_GF_USER_CHAT","dismissGame","SUB_GF_USER_DISMISS_REQ","agreeDismiss","agree","SUB_GF_USER_DISMISS_AGREE","SUB_GR_USER_ENTER","onUserEnter","SUB_GR_USER_STATUS","onSubUserStatus","SUB_GR_USER_SCORE","onSubUserScore","SUB_GF_GAME_SCENE","error","SUB_GF_GAME_STATUS","SUB_GF_ROOM_INFO","onUserAgreeDismiss","SUB_GF_DO_DISMISS_GAME","resetDismissState","SUB_GF_DISMISS_GAME_FAILED","sendSocketData","tableID","chairID","userStatus","US_FREE","deleteUserItem","updateUserItemStatus","score","updateUserItemScore","infoArray","createNewUserItem","switchViewChairID","chairCount","GAME_PLAYER_NUM","viewChairID","Math","floor","getChairID","getMeChairID","getMeUserItem","getTableUserItem","getUserByGameID","gameID","sendUserReady","SUB_GF_USER_READY","nickname","onUserItemDelete","onUserItemUpdateScore","scoreInfo","onUserItemUpdateStatus","statusInfo","getGameConfig","playerCount"],"mappings":"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","file":"ClientKernel.js","sourcesContent":["\r\nvar NetHelp = require(\"NetHelp\")\r\n\r\nvar GD = require(\"GD\")\r\nvar define = require('define');\r\nvar GameUserManager = require('GameUserManager');\r\n\r\n\r\nvar gameCMD = define.gameCMD;\r\nvar gameConst = define.gameConst;\r\n\r\n\r\nvar ClientKernel = cc.Class({\r\n\r\n    properties: {\r\n        gameUserManager: null,\r\n        gameStatus: null,\r\n        myUserItem: null,\r\n        myUserID: null,\r\n        serverReady: false, //服务端是否准备好, 当成功触发onReady后， 就会重置为false， 防止重复触发\r\n        clientReady: false, //客户端是否准备好，当成功触发onReady后， 就会重置为false， 防止重复触发\r\n        tableSetting: null, //桌子信息\r\n\r\n    },\r\n\r\n\r\n    ctor: function() {\r\n        this.gameUserManager = new GameUserManager();\r\n        this.gameUserManager.init(this);\r\n        this.myUserID = GD.userID;\r\n        onfire.on(\"gamemsg\", this.onEventMessage.bind(this))\r\n    },\r\n\r\n\r\n\r\n    getUserMgr: function() {\r\n        return this.gameUserManager\r\n    },\r\n\r\n    getTableSetting: function() {\r\n        return this.tableSetting\r\n    },\r\n\r\n\r\n    webSocketSend: function(data) {\r\n        var roomID = 130\r\n        data.roomID = roomID\r\n        data.userID = this.myUserID\r\n        NetHelp.sendGameMessage(\"onClientSocketEvent\", data)\r\n\r\n    },\r\n\r\n\r\n\r\n    /**\r\n     * 消息事件\r\n     * @param data\r\n     * @returns {boolean}\r\n     */\r\n    onEventMessage: function(data) {\r\n\r\n        switch (data[\"mainCMD\"]) {\r\n\r\n            case gameCMD.MDM_GR_LOGON:\r\n                this.onSocketMainLogon(data[\"subCMD\"], data[\"data\"]);\r\n                break;\r\n            case gameCMD.MDM_GR_USER:\r\n                this.onSocketMainUser(data[\"subCMD\"], data[\"data\"]);\r\n                return true;\r\n\r\n            case gameCMD.MDM_GF_GAME:\r\n                this.onSocketMainGame(data[\"subCMD\"], data[\"data\"]);\r\n                return true;\r\n\r\n            case gameCMD.MDM_GF_FRAME:\r\n                this.onSocketMainFrame(data[\"subCMD\"], data[\"data\"]);\r\n                return true;\r\n        }\r\n    },\r\n\r\n /**\r\n     * 登录处理函数\r\n     * @param subCMD\r\n     * @param data\r\n     * @returns {boolean}\r\n     */\r\n    onSocketMainLogon: function (subCMD, data) {\r\n        switch (subCMD) {\r\n            //登录成功\r\n            case gameCMD.SUB_GR_LOGON_SUCCESS:\r\n                //登录成功就获取自己\r\n                this.myUserID = data[\"userID\"];\r\n                this.gameConfig = data[\"gameConfig\"];\r\n                this.myUserItem = this.gameUserManager.getUserByUserID(this.myUserID);\r\n                console.log('用户信息',this.myUserItem)                //this.onEventSelfEnter(this.myUserItem);\r\n                //获取游戏信息\r\n                //this.webSocket.send({mainCMD:gameCMD.MDM_GF_FRAME, subCMD:gameCMD.SUB_GF_GAME_OPTION});\r\n                this.serverReady = true;\r\n                this.loginSuccess = true;\r\n                if (this.clientReady) {\r\n                    this.onReady();\r\n                    this.serverReady = false;\r\n                }\r\n                console.log(\"登录成功吗吗吗吗吗\", data)\r\n                onfire.fire(\"onLogonSuccess\", this.myUserID, data)\r\n                return true;\r\n\r\n            default :\r\n                return true;\r\n        }\r\n    },\r\n\r\n\r\n    onClientReady: function() {\r\n        this.clientReady = true;\r\n        if (this.serverReady) {\r\n            this.onReady();\r\n            this.clientReady = false;\r\n        }\r\n    },\r\n\r\n    onReady: function() {\r\n        this.onEventSelfEnter(this.myUserItem);\r\n        //获取场景游戏信息\r\n        this.webSocketSend({\r\n            mainCMD: gameCMD.MDM_GF_FRAME,\r\n            subCMD: gameCMD.SUB_GF_GAME_OPTION\r\n        });\r\n\r\n        //自己先进\r\n        this.onUserItemActive(this.myUserItem);\r\n\r\n        var userItem = null;\r\n        for (var i = 0; i < this.gameUserManager.tableUserItem.length; ++i) {\r\n            userItem = this.gameUserManager.tableUserItem[i];\r\n            if (!userItem || userItem == this.myUserItem) continue;\r\n            this.onUserItemActive(userItem);\r\n        }\r\n\r\n\r\n    },\r\n\r\n    getRoomInfo: function() {\r\n\r\n        //获取场景游戏信息\r\n        this.webSocketSend({\r\n            mainCMD: gameCMD.MDM_GF_FRAME,\r\n            subCMD: gameCMD.SUB_GF_GAME_OPTION\r\n        });\r\n    },\r\n\r\n    chat: function(text) {\r\n\r\n        this.webSocketSend({\r\n            mainCMD: gameCMD.MDM_GF_FRAME,\r\n            subCMD: gameCMD.SUB_GF_USER_CHAT,\r\n            text\r\n\r\n\r\n        });\r\n    },\r\n\r\n\r\n    //解散游戏\r\n    dismissGame: function() {\r\n        //获取场景游戏信息\r\n        this.webSocketSend({\r\n            mainCMD: gameCMD.MDM_GF_FRAME,\r\n            subCMD: gameCMD.SUB_GF_USER_DISMISS_REQ\r\n\r\n        });\r\n    },\r\n\r\n    agreeDismiss: function(agree) {\r\n        agree = agree || 0\r\n        //获取场景游戏信息\r\n        this.webSocketSend({\r\n            mainCMD: gameCMD.MDM_GF_FRAME,\r\n            subCMD: gameCMD.SUB_GF_USER_DISMISS_AGREE,            \r\n            agree\r\n\r\n        });\r\n    },\r\n\r\n\r\n    /**\r\n     * 用户命令函数\r\n     * @param subCMD\r\n     * @param data\r\n     * @returns {boolean}\r\n     */\r\n    onSocketMainUser: function(subCMD, data) {\r\n        console.log(\"onSocketMainUser\", subCMD, data)\r\n        switch (subCMD) {\r\n            case gameCMD.SUB_GR_USER_ENTER:\r\n                this.onUserEnter(data);\r\n                return true;\r\n            case gameCMD.SUB_GR_USER_STATUS:\r\n                this.onSubUserStatus(data);\r\n                return true;\r\n            case gameCMD.SUB_GR_USER_SCORE:\r\n                this.onSubUserScore(data);\r\n            default:\r\n                return true;\r\n        }\r\n    },\r\n\r\n    /**\r\n     * 游戏命令函数\r\n     * @param subCMD\r\n     * @param data\r\n     */\r\n    onSocketMainGame: function(subCMD, data) {\r\n\r\n        console.log(\"onEventGameMessage\", subCMD, data);\r\n        onfire.fire(\"onEventGameMessage\", subCMD, data);\r\n    },\r\n\r\n    /**\r\n     * 框架命令函数\r\n     * @param subCMD\r\n     * @param data\r\n     * @returns {boolean}\r\n     */\r\n    onSocketMainFrame: function(subCMD, data) {\r\n        switch (subCMD) {\r\n            case gameCMD.SUB_GF_GAME_SCENE:\r\n                console.log('data',data)\r\n                console.error(\"onEventSceneMessage\", this.gameStatus, data);\r\n                onfire.fire(\"onEventSceneMessage\", this.gameStatus, data);\r\n                return true;\r\n\r\n            case gameCMD.SUB_GF_GAME_STATUS:\r\n                this.gameStatus = data[\"gameStatus\"];\r\n                return true;\r\n\r\n            case gameCMD.SUB_GF_ROOM_INFO:\r\n                if (data.tableSetting) {\r\n                    this.tableSetting = data.tableSetting\r\n                }\r\n                onfire.fire(\"onGotRoomInfo\", subCMD, data);\r\n                return true;\r\n\r\n\r\n            case gameCMD.SUB_GF_USER_CHAT:\r\n                onfire.fire(\"onNewChatMsg\", data);\r\n                return true;\r\n\r\n           case gameCMD.SUB_GF_USER_DISMISS_REQ: //用户发起解散 \r\n                onfire.fire(\"onUserStartDismiss\", subCMD, data);\r\n                return true;                \r\n            case gameCMD.SUB_GF_USER_DISMISS_AGREE: //用户同意解散 \r\n                this.onUserAgreeDismiss(data)\r\n                onfire.fire(\"onUserAgreeDismiss\", subCMD, data);\r\n                return true;\r\n            case gameCMD.SUB_GF_DO_DISMISS_GAME: //房间已解散消息 \r\n                this.resetDismissState(data)\r\n                onfire.fire(\"onDismissGame\", subCMD, data);\r\n                return true;\r\n            case gameCMD.SUB_GF_DISMISS_GAME_FAILED: //房间j解散失败 \r\n                this.resetDismissState(data)\r\n                onfire.fire(\"onDismissGameFailed\", subCMD, data);\r\n                return true;\r\n            default:\r\n                console.log(\"onEventFrameMessage\", subCMD, data);\r\n                onfire.fire(\"onEventFrameMessage\", subCMD, data);\r\n                return true;\r\n        }\r\n    },\r\n\r\n    /**\r\n     * 发送消息\r\n     * @param mainCMD\r\n     * @param subCMD\r\n     * @param data\r\n     */\r\n    sendSocketData: function(mainCMD, subCMD, data) {\r\n\r\n        data.mainCMD = mainCMD;\r\n        data.subCMD = subCMD;\r\n\r\n        this.webSocketSend(data);\r\n    },\r\n\r\n    /**\r\n     * 用户状态\r\n     * @param data 数据\r\n     * @returns {boolean}\r\n     */\r\n    onSubUserStatus: function(data) {\r\n        var userID = data[\"userID\"];\r\n        var tableID = data[\"tableID\"];\r\n        var chairID = data[\"chairID\"];\r\n        var userStatus = data[\"userStatus\"];\r\n\r\n        console.log(\"onSubUserStatus 0\", data)\r\n        var userItem = this.gameUserManager.getUserByUserID(userID);\r\n        if (userItem == null) return true;\r\n\r\n        if (userStatus <= gameConst.US_FREE) {\r\n            this.gameUserManager.deleteUserItem(userItem);\r\n        } else {\r\n            this.gameUserManager.updateUserItemStatus(userItem, {\r\n                tableID: tableID,\r\n                chairID: chairID,\r\n                userStatus: userStatus\r\n            });\r\n        }\r\n\r\n        console.log(\"UserStatusChanged\", data)\r\n        onfire.fire(\"UserStatusChanged\", data);\r\n\r\n        return true;\r\n    },\r\n    /**\r\n     * 用户分数变更\r\n     * @param data\r\n     */\r\n    onSubUserScore: function(data) {\r\n        var userID = data[\"userID\"];\r\n        var score = data[\"score\"];\r\n\r\n        var userItem = this.gameUserManager.getUserByUserID(userID);\r\n        if (userItem == null) return true;\r\n\r\n        this.gameUserManager.updateUserItemScore(userItem, score);\r\n    },\r\n\r\n    /**\r\n     * 用户进入\r\n     * @param data\r\n     * @returns {boolean}\r\n     */\r\n    onUserEnter: function(data) {\r\n        var infoArray = data;\r\n        console.log(\"onUserEnter\", infoArray)\r\n        for (var i = 0; i < infoArray.length; ++i) {\r\n            //创建玩家\r\n            console.log(infoArray[i])\r\n            this.gameUserManager.createNewUserItem(infoArray[i]);\r\n        }\r\n    },\r\n\r\n    /**\r\n     * 切换视图椅子\r\n     * @param chairID\r\n     */\r\n    switchViewChairID: function(chairID) {\r\n\r\n        var chairCount = gameConst.GAME_PLAYER_NUM;\r\n        var viewChairID = Math.floor((chairID + chairCount * 3 / 2 - this.myUserItem.getChairID()) % chairCount);\r\n        return viewChairID;\r\n    },\r\n\r\n\r\n    /**\r\n     * 获取自己椅子ID\r\n     * @returns {*}\r\n     */\r\n    getMeChairID: function() {\r\n        return this.myUserItem.getChairID();\r\n    },\r\n\r\n    /**\r\n     * 获取自己\r\n     * @returns {null}\r\n     */\r\n    getMeUserItem: function() {\r\n        return this.myUserItem;\r\n    },\r\n\r\n    /**\r\n     * 获取座位玩家\r\n     * @param chairID\r\n     * @returns {*}\r\n     */\r\n    getTableUserItem: function(chairID) {\r\n        return this.gameUserManager.getTableUserItem(chairID);\r\n    },\r\n\r\n    /**\r\n     * 通过UserID获取用户\r\n     * @param userID\r\n     * @returns {*}\r\n     */\r\n    getUserByUserID: function(userID) {\r\n\r\n        return this.gameUserManager.getUserByUserID(userID);\r\n    },\r\n\r\n    /**\r\n     * 通过游戏ID获取用户\r\n     */\r\n    getUserByGameID: function(gameID) {\r\n\r\n        return this.gameUserManager.getUserByGameID(gameID);\r\n    },\r\n\r\n    /**\r\n     * 发送准备\r\n     * @returns {boolean}\r\n     */\r\n    sendUserReady: function() {\r\n        this.webSocketSend({\r\n            mainCMD: gameCMD.MDM_GF_FRAME,\r\n            subCMD: gameCMD.SUB_GF_USER_READY\r\n        });\r\n        return true;\r\n    },\r\n\r\n\r\n    /**\r\n     *用户信息变化处理\r\n     */\r\n\r\n\r\n\r\n    /**\r\n     * 玩家激活\r\n     * @param userItem\r\n     * @returns {boolean}\r\n     */\r\n    onUserItemActive: function(userItem) {\r\n\r\n        cc.log(\"onEventUserEnter\", userItem.nickname, userItem.userID);\r\n        onfire.fire(\"onEventUserEnter\", userItem);\r\n    },\r\n\r\n    /**\r\n     * 玩家删除\r\n     * @param userItem\r\n     * @returns {boolean}\r\n     */\r\n    onUserItemDelete: function(userItem) {\r\n        if (userItem == null) {\r\n            return false;\r\n        }\r\n\r\n        cc.log(\"onUserItem Delete\");\r\n        cc.log(\"onEventUserLeave\", userItem);\r\n        onfire.fire(\"onEventUserLeave\", userItem);\r\n    },\r\n\r\n    /**\r\n     * 分数更新\r\n     * @param userItem\r\n     * @param scoreInfo\r\n     * @returns {boolean}\r\n     */\r\n    onUserItemUpdateScore: function(userItem, scoreInfo) {\r\n        if (userItem == null) {\r\n            return false;\r\n        }\r\n        cc.log(\"onEventUserScore\", userItem.nickname, userItem.userID);\r\n        onfire.fire(\"onEventUserScore\", userItem);\r\n    },\r\n\r\n    /**\r\n     * 状态更新\r\n     * @param userItem\r\n     * @param statusInfo\r\n     * @returns {boolean}\r\n     */\r\n    onUserItemUpdateStatus: function(userItem, statusInfo) {\r\n        cc.log(\"onEventUserStatus\", userItem.nickname, userItem.userID);\r\n        onfire.fire(\"onEventUserStatus\", userItem);\r\n    },\r\n\r\n    /**\r\n     * 自己进入\r\n     * @param userItem\r\n     * @returns {boolean}\r\n     */\r\n    onEventSelfEnter: function(userItem) {\r\n\r\n        cc.log(\"onEventSelfEnter\", userItem.nickname, userItem.userID);\r\n        onfire.fire(\"onEventSelfEnter\", userItem);\r\n    },\r\n\r\n    /**\r\n     * 获取游戏配置\r\n     * @returns {null}\r\n     */\r\n    getGameConfig: function() {\r\n        return this.gameConfig;\r\n    },\r\n\r\n    /**\r\n     * 玩家同意解散\r\n     * @param userItem\r\n     * @returns {boolean}\r\n     */\r\n    onUserAgreeDismiss: function(data) {\r\n        var chairID = data[\"chairID\"];\r\n\r\n        var userItem = this.gameUserManager.getTableUserItem(chairID);\r\n        if (userItem == null) return true;\r\n        userItem.agreeDismiss = data.agree || 0\r\n        return true;\r\n\r\n    },\r\n\r\n    resetDismissState: function(data) {\r\n        var tableSetting = this.getTableSetting()\r\n        for (var i = 0; i < tableSetting.playerCount; i++) {\r\n            var chairID = i\r\n            var userItem = this.gameUserManager.getTableUserItem(chairID);\r\n            if (userItem) {\r\n                userItem.agreeDismiss = -1\r\n            }\r\n        }\r\n    },\r\n\r\n});"]}