{"version":3,"sources":["../../../../assets/Script/scene/room.js"],"names":["NetHelp","require","ClientKernel","GD","cc","Class","extends","Component","onLoad","enterRoomIng","clientKernel","node_rooms","node","getChildByName","i","children","length","btn_room","on","onRoomBtnClick","bind","bindObj","push","onfire","onLogonSuccess","start","onDestroy","un","event","data","loader","onProgress","completedCount","totalCount","item","progress","toFixed","director","preloadScene","loadScene","onClientReady","roomID","anim_name","scheduleOnce","enterRoom","console","log","connect"],"mappings":";;AAAA,IAAIA,UAAUC,QAAQ,SAAR,CAAd;AACA,IAAIC,eAAeD,QAAQ,cAAR,CAAnB;AACA,IAAIE,KAAKF,QAAQ,IAAR,CAAT;;AAIAG,GAAGC,KAAH,CAAS;AACLC,aAASF,GAAGG,SADP;;AAGL;AACAC,YAAQ,kBAAW;;AAEf,aAAKC,YAAL,GAAoB,KAApB,CAFe,CAEW;AAC1BN,WAAGO,YAAH,GAAkB,IAAIR,YAAJ,EAAlB;;AAEA,aAAKS,UAAL,GAAkB,KAAKC,IAAL,CAAUC,cAAV,CAAyB,YAAzB,CAAlB;AACA,aAAK,IAAIC,IAAI,CAAb,EAAgBA,IAAI,KAAKH,UAAL,CAAgBI,QAAhB,CAAyBC,MAA7C,EAAqDF,GAArD,EAA0D;AACtD,gBAAIG,WAAW,KAAKN,UAAL,CAAgBI,QAAhB,CAAyBD,CAAzB,CAAf;AACAG,qBAASC,EAAT,CAAY,UAAZ,EAAwB,KAAKC,cAAL,CAAoBC,IAApB,CAAyB,IAAzB,EAA+BN,CAA/B,CAAxB,EAFsD,CAEK;AAC9D;;AAGD,aAAKO,OAAL,GAAe,EAAf;AACA,aAAKA,OAAL,CAAaC,IAAb,CAAkBC,OAAOL,EAAP,CAAU,gBAAV,EAA4B,KAAKM,cAAL,CAAoBJ,IAApB,CAAyB,IAAzB,CAA5B,CAAlB;AAEH,KAnBI;;AAsBLK,SAtBK,mBAsBG,CAEP,CAxBI;AA2BLC,aA3BK,uBA2BO;AACR,aAAK,IAAIZ,IAAI,CAAb,EAAgBA,IAAI,KAAKO,OAAL,CAAaL,MAAjC,EAAyCF,GAAzC,EAA8C;AAC1CS,mBAAOI,EAAP,CAAU,KAAKN,OAAL,CAAaP,CAAb,CAAV;AACH;AAEJ,KAhCI;AAmCLU,kBAnCK,0BAmCUI,KAnCV,EAmCgBC,IAnChB,EAmCsB;AACvBzB,WAAG0B,MAAH,CAAUC,UAAV,GAAuB,UAASC,cAAT,EAAyBC,UAAzB,EAAqCC,IAArC,EAA2C;AAC9D,gBAAIC,WAAW,CAAC,MAAMH,cAAN,GAAuBC,UAAxB,EAAoCG,OAApC,CAA4C,CAA5C,CAAf;AACA;AACA;AACH,SAJD;;AAMA;AACAhC,WAAGiC,QAAH,CAAYC,YAAZ,CAAyB,MAAzB,EAAiC,YAAW;AACxClC,eAAGiC,QAAH,CAAYE,SAAZ,CAAsB,MAAtB;AACApC,eAAGO,YAAH,CAAgB8B,aAAhB;AACH,SAHD;AAIH,KA/CI;AAkDLrB,kBAlDK,0BAkDUsB,MAlDV,EAkDkBb,KAlDlB,EAkDyB;AAC1B,YAAI,KAAKnB,YAAT,EAAuB;AACnB;AACH;AACD,aAAKA,YAAL,GAAoB,IAApB;AACA,YAAIQ,WAAW,KAAKN,UAAL,CAAgBI,QAAhB,CAAyB0B,MAAzB,CAAf;AACA,YAAIC,YAAY,cAAc,KAAKD,SAAS,CAAd,CAA9B;AACA;AACA;;AAEA,aAAKE,YAAL,CAAkB,YAAW;AACzB,iBAAKC,SAAL,CAAeH,MAAf;AACH,SAFD,EAEG,CAFH;AAMH,KAlEI;AAqELG,aArEK,qBAqEKH,MArEL,EAqEa;AACdI,gBAAQC,GAAR,CAAY,QAAZ,EAAsBL,MAAtB;AACA,aAAKG,SAAL,GAAiB,KAAjB;AACA5C,gBAAQ+C,OAAR;AAEH;AA1EI,CAAT","file":"room.js","sourcesContent":["var NetHelp = require(\"NetHelp\")\r\nvar ClientKernel = require(\"ClientKernel\")\r\nvar GD = require(\"GD\")\r\n\r\n\r\n\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    // use this for initialization\r\n    onLoad: function() {\r\n\r\n        this.enterRoomIng = false //\r\n        GD.clientKernel = new ClientKernel()\r\n\r\n        this.node_rooms = this.node.getChildByName(\"node_rooms\")\r\n        for (var i = 0; i < this.node_rooms.children.length; i++) {\r\n            var btn_room = this.node_rooms.children[i]\r\n            btn_room.on(\"touchend\", this.onRoomBtnClick.bind(this, i)) //每个按钮注册事件\r\n        }\r\n\r\n\r\n        this.bindObj = []\r\n        this.bindObj.push(onfire.on(\"onLogonSuccess\", this.onLogonSuccess.bind(this)))\r\n\r\n    },\r\n\r\n\r\n    start() {\r\n\r\n    },\r\n\r\n\r\n    onDestroy() {\r\n        for (var i = 0; i < this.bindObj.length; i++) {\r\n            onfire.un(this.bindObj[i])\r\n        }\r\n\r\n    },\r\n\r\n\r\n    onLogonSuccess(event,data) {\r\n        cc.loader.onProgress = function(completedCount, totalCount, item) {\r\n            var progress = (100 * completedCount / totalCount).toFixed(2);\r\n            //cc.log(progress + '%');\r\n            //这里显示loading进度\r\n        }\r\n\r\n        //预加载场景\r\n        cc.director.preloadScene(\"game\", function() {\r\n            cc.director.loadScene(\"game\");\r\n            GD.clientKernel.onClientReady();\r\n        });\r\n    },\r\n\r\n\r\n    onRoomBtnClick(roomID, event) {\r\n        if (this.enterRoomIng) {\r\n            return\r\n        }\r\n        this.enterRoomIng = true\r\n        var btn_room = this.node_rooms.children[roomID]\r\n        var anim_name = \"Animation\" + 2 * (roomID + 1)\r\n        // var spine = btn_room.getComponentInChildren(sp.Skeleton)\r\n        // spine.setAnimation(0, anim_name, false); //播放选择动画\r\n\r\n        this.scheduleOnce(function() {\r\n            this.enterRoom(roomID)\r\n        }, 1);\r\n\r\n\r\n\r\n    },\r\n\r\n\r\n    enterRoom(roomID) {\r\n        console.log(\"正在进入房间\", roomID)\r\n        this.enterRoom = false\r\n        NetHelp.connect();\r\n\r\n    },\r\n\r\n\r\n});"]}