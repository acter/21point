{"version":3,"sources":["../../../../assets/Script/scene/scene.js"],"names":["NetHelp","require","subGameMSG","ClientKernel","GD","Player","define","gameCMD","gameEvent","gameConst","ZZConfig","cc","Class","properties","userPreb","default","type","Prefab","goldPreb","sprite","SpriteAtlas","extends","Component","onLoad","players","isGameStarted","bindEvent","gameResultLayer","lastBetNum","initNodes","bindObj","push","onfire","on","onEventGameMessage","bind","onEventSceneMessage","playerPos","node","getChildByName","bet_list","i","children","length","bet_btn","bet_num","getComponent","Label","string","bet","myUserItem","clientKernel","coin","instantiate","chairID","onWagerHandler","data","sendGameData","subCMD","sendSocketData","MDM_GF_GAME","gameStatus","isGameOver","playerData","len","curData","player","playSit","log","userID","showTip","playChair","newPlayer","templayer","addComponent","script","loadInfo","addChild","active"],"mappings":"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","file":"scene.js","sourcesContent":["var NetHelp = require(\"NetHelp\")\r\nvar subGameMSG = require(\"SubGameMSG\").subGameMSG\r\nvar ClientKernel = require(\"ClientKernel\")\r\nvar GD = require(\"GD\")\r\nvar Player = require('player')\r\nvar define = require('define');\r\nvar gameCMD = define.gameCMD;\r\nvar gameEvent = define.gameEvent;\r\nvar gameConst = define.gameConst;\r\nvar ZZConfig = require(\"Config\").ZZConfig\r\n\r\ncc.Class({\r\n    properties:{\r\n          userPreb:{\r\n            default:null,\r\n            type:cc.Prefab\r\n          },\r\n            goldPreb:{\r\n                default:null,\r\n                type:cc.Prefab\r\n            },\r\n        sprite:{\r\n            default:null,\r\n            type:cc.SpriteAtlas\r\n        }\r\n    },\r\n    extends: cc.Component,\r\n    onLoad:function(){\r\n\r\n        this.players = [];\r\n        this.isGameStarted = false;\r\n        this.bindEvent();\r\n        this.gameResultLayer = null;\r\n        this.lastBetNum = 0;//上次下注数\r\n        this.initNodes()\r\n\r\n    },\r\n    bindEvent() {\r\n\r\n        this.bindObj = []\r\n        this.bindObj.push(onfire.on(\"onEventGameMessage\", this.onEventGameMessage.bind(this)))\r\n        this.bindObj.push(onfire.on(\"onEventSceneMessage\", this.onEventSceneMessage.bind(this)))\r\n\r\n    },\r\n    initNodes(){\r\n        this.playerPos = this.node.getChildByName('21dian-player');\r\n        this.bet_list = this.node.getChildByName('bet_btn_list')\r\n        for(var i = 0; i < this.bet_list.children.length;i++){\r\n            var bet_btn = this.bet_list.children[i];\r\n\r\n            //下注金币\r\n\r\n            var bet_num = bet_btn.children[0].getComponent(cc.Label).string;\r\n\r\n            bet_btn.on('touchend',this.bet.bind(this, bet_num))\r\n\r\n        }\r\n\r\n    },\r\n    //下注\r\n    bet(bet_num){\r\n        var myUserItem = GD.clientKernel.myUserItem;\r\n        var coin = cc.instantiate(this.goldPreb);\r\n\r\n        this.players[myUserItem.chairID].onWagerHandler(bet_num,coin);\r\n    },\r\n    // 加载开始提示\r\n    // loadStartTip: function(){\r\n    //     var size  = cc.winSize;\r\n    //     var x = size.width * 0.5;\r\n    //     var y = size.height * 0.6;\r\n    //\r\n    //     this.startSpr = new cc.Sprite(\"#21dian/start.png\").to(this, 1).p(-x, y);\r\n    // },\r\n    //游戏内消息\r\n    onEventGameMessage:function(data){\r\n\r\n    },\r\n    //发送子游戏事件\r\n\r\n    sendGameData: function(subCMD, data) {\r\n        GD.clientKernel.sendSocketData(gameCMD.MDM_GF_GAME, subCMD, data);\r\n    },\r\n//场景还原\r\n    onEventSceneMessage: function(gameStatus, data) {\r\n\r\n        var myUserItem = GD.clientKernel.myUserItem;\r\n        var isGameOver = data.isGameOver;\r\n        var playerData = data.playerData;\r\n\r\n\r\n        for (var i = 0, len = playerData.length; i < len; i++) {\r\n            var curData = playerData[i];\r\n            var chairID = curData.chairID;\r\n            //各个玩家坐下\r\n            var player =  this.playSit(chairID,curData);\r\n            cc.log('playerData',playerData)\r\n            // // 提示玩家所在位置\r\n            if (curData.userID == myUserItem.userID) {\r\n\r\n                player.showTip();\r\n            }\r\n\r\n            // if (!isGameOver) {\r\n            //     // 间隔发牌\r\n            //     this.delayDeal(playerSpr, curData, i, data.dealID);\r\n            //     if (data.isWagering) {\r\n            //         playerSpr.showProgressTimer(data.leftTime);\r\n            //     }\r\n            // }\r\n            //\r\n            // this.players.push(playerSpr);\r\n            // this.players[chairID] = playerSpr;\r\n        }\r\n\r\n        // 更新卡牌数量\r\n        // this.roomInfoLayer && this.roomInfoLayer.updateCardNum(data.cardLeftNum);\r\n    },\r\n    //玩家坐下\r\n    playSit(chairID,data){\r\n\r\n        this.playChair = this.playerPos.getChildByName('pos'+chairID)\r\n        var newPlayer = cc.instantiate(this.userPreb);\r\n        let templayer= newPlayer.addComponent(Player);\r\n\r\n        var script = newPlayer.getComponent('player')\r\n        script.loadInfo(data)\r\n        this.playChair.addChild(newPlayer);\r\n        this.playChair.active = true;\r\n        this.players[chairID] = templayer;\r\n        //\r\n        return script;\r\n    }\r\n\r\n});"]}