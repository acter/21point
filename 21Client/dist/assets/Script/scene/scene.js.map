{"version":3,"sources":["../../../../assets/Script/scene/scene.js"],"names":["NetHelp","require","subGameMSG","ClientKernel","GD","Player","define","gameCMD","gameEvent","gameConst","cc","Class","properties","userPreb","default","type","Prefab","goldPreb","Allsprite","SpriteAtlas","extends","Component","onLoad","players","roomIndex","buttonLayer","isGameStarted","startSpr","loadStartTip","gameResultLayer","curBet","bindEvent","initMembers","lastBetNum","initNodes","playerPos","node","getChildByName","button_list","i","num","bindObj","push","onfire","on","onEventGameMessage","bind","onEventSceneMessage","startSprIn","sizeA","winSize","sizeB","getContentSize","x","width","runAction","sequence","moveTo","p","easing","easeBackOut","delayTime","easeBackIn","callFunc","setPosition","gameStatus","data","myUserItem","clientKernel","isGameOver","playerData","loadRoomInfoLayer","loadUILayer","len","length","curData","chairID","playerSpr","playerSit","userID","showTip","delayDeal","dealID","isWagering","showProgressTimer","timeLeft","roomInfoLayer","updateCardNum","cardLeftNum","cards","setTimeout","loadCardBoxes","playChair","isDealer","newPlayer","instantiate","addChild","getComponent","active","loadInfo","left","onWageringHandler","leftTime","showBetLayer","getMyPlayerScore","onWagerHandler","wagerP","findPlayerByID","setBaseBet","betNum","onDealHandler","count","allPlayerCurCards","hideProgressTimer","j","lenJ","lenI","cardData","id","getUserID","setIsPlaying","setBetLayerVisible","onNextActionHandler","showOperateLayer","setSplitAndDouble","canSplit","canDouble","player","setHitTipVisible","selfKey","onInsuranceHandler","isPlaying","insuranceLayer","InsuranceLayer","onCloseInsuranceLayer","to","onBuyInsuranceHandler","curPlayer","SoundEngine","playEffect","TYPE_YES","gameEngine","sendInsuranceMessage","TYPE_INSURANCE","flag","removeFromParent","onHitHandler","result","curCards","isDouble","isBust","isFiveDragon","setOperateButtonsOpacity","setOperateLayerVisible","getCurScore","subCMD","TYPE_WAGERING","TYPE_WAGER","TYPE_DEAL","TYPE_NEXT_ACTION"],"mappings":"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","file":"scene.js","sourcesContent":["var NetHelp = require(\"NetHelp\")\r\nvar subGameMSG = require(\"SubGameMSG\").subGameMSG\r\nvar ClientKernel = require(\"ClientKernel\")\r\nvar GD = require(\"GD\")\r\nvar Player = require('player')\r\nvar define = require('define');\r\nvar gameCMD = define.gameCMD;\r\n\r\nvar gameEvent = define.gameEvent;\r\nvar gameConst = define.gameConst;\r\n\r\n\r\ncc.Class({\r\n    properties:{\r\n        userPreb:{\r\n            default:null,\r\n            type:cc.Prefab\r\n        },\r\n        goldPreb:{\r\n            default:null,\r\n            type:cc.Prefab\r\n        },\r\n        Allsprite:{\r\n            default:null,\r\n            type:cc.SpriteAtlas\r\n        }\r\n    },\r\n    extends: cc.Component,\r\n    onLoad:function(){\r\n        this.players = [];\r\n        this.roomIndex = 0;\r\n        this.buttonLayer = null;\r\n        this.isGameStarted = false;\r\n        this.startSpr = null;\r\n        // 加载开始提示\r\n        this.loadStartTip()\r\n        this.gameResultLayer = null;\r\n        this.curBet = 0;\r\n        this.bindEvent();\r\n        this.initMembers()\r\n        this.lastBetNum = 0;//上次下注数\r\n        this.initNodes()\r\n    },\r\n    //初始化节点\r\n    initNodes(){\r\n        // 常量\r\n        this.playerPos = this.node.getChildByName('21dian-player');\r\n        //按钮节点\r\n        this.button_list = this.node.getChildByName('button')\r\n    },\r\n    // 初始化成员变量\r\n    initMembers: function(){\r\n        // 初始化出6个空位置。五个玩家、一个庄家\r\n        for (var i = 0, num = 6; i < num; i++) {\r\n            this.players[i] = null;\r\n        }\r\n    },\r\n    bindEvent() {\r\n        this.bindObj = []\r\n        this.bindObj.push(onfire.on(\"onEventGameMessage\", this.onEventGameMessage.bind(this)))\r\n        this.bindObj.push(onfire.on(\"onEventSceneMessage\", this.onEventSceneMessage.bind(this)))\r\n\r\n    },\r\n    //加载开始提示\r\n    loadStartTip(){\r\n        this.startSpr = this.node.getChildByName('21dian-start');\r\n    },\r\n    startSprIn: function(){\r\n        // 开始提示精灵进场\r\n        if (this.startSpr == null) return;\r\n        var sizeA  = cc.winSize;\r\n        var sizeB = this.startSpr.getContentSize()\r\n        var x = (sizeA.width+sizeB.width)*0.5;\r\n        this.startSpr.runAction(cc.sequence(\r\n            cc.moveTo(0.5, cc.p(0, 0)).easing(cc.easeBackOut(0.5)),\r\n            cc.delayTime(0.5),\r\n            cc.moveTo(0.5,cc.p(x, 0)).easing(cc.easeBackIn(0.5)),\r\n            cc.callFunc(function(){\r\n                this.startSpr.setPosition(-x,0);\r\n            }.bind(this))\r\n        ));\r\n    },\r\n    /*\r\n  * 逻辑处理\r\n  * */\r\n    // 场景还原\r\n    onEventSceneMessage(gameStatus,data){\r\n        // data: {playerData: ,dealID: ,isGameOver: ,cardLeftNum: ,\r\n        // timeLeft: ,isWagering: ,roomIndex:}\r\n        var myUserItem = GD.clientKernel.myUserItem;\r\n        var isGameOver = data.isGameOver;\r\n        var playerData = data.playerData;\r\n        this.roomIndex = data.roomIndex;\r\n        // 加载房间信息层\r\n        this.loadRoomInfoLayer();\r\n        //加载下注层\r\n        this.loadUILayer()\r\n        for (var i = 0, len = playerData.length; i < len; i++) {\r\n            var curData = playerData[i];\r\n            var chairID = curData.chairID;\r\n            var playerSpr = this.playerSit(chairID,curData);\r\n\r\n            // 提示玩家所在位置\r\n            if (curData.userID == myUserItem.userID) {\r\n                playerSpr.showTip();\r\n            }\r\n            if (!isGameOver) {\r\n                // 间隔发牌\r\n                this.delayDeal(playerSpr, curData, i, data.dealID);\r\n                if (data.isWagering) {\r\n                    playerSpr.showProgressTimer(data.timeLeft);\r\n                }\r\n            }\r\n            // // this.players.push(playerSpr);\r\n            this.players[chairID] = playerSpr;\r\n        }\r\n        // 更新卡牌数量\r\n        this.roomInfoLayer && this.roomInfoLayer.updateCardNum(data.cardLeftNum);\r\n    },\r\n    //延迟发牌\r\n    delayDeal: function(playerSpr, curData, i, dealID){\r\n        if (curData.cards) {\r\n            setTimeout(function(){\r\n                playerSpr.loadCardBoxes(curData.cards, dealID);\r\n            }, 600 * i);\r\n        }\r\n    },\r\n    //加载玩家座位\r\n    playerSit(chairID,data){\r\n        var playChair = this.playerPos.getChildByName('pos'+chairID)\r\n        if(data.isDealer){\r\n            var playChair = this.playerPos.getChildByName('pos5')\r\n        }\r\n        var newPlayer = cc.instantiate(this.userPreb);\r\n        // let templayer= newPlayer.addComponent(Player);\r\n        playChair.addChild(newPlayer);\r\n        var playerSpr = newPlayer.getComponent('player')\r\n\r\n        playChair.active = true;\r\n        playerSpr.loadInfo(data,this.Allsprite)\r\n\r\n        //\r\n        return playerSpr;\r\n    },\r\n    // 加载房间信息层\r\n    loadRoomInfoLayer(data){\r\n        if (this.roomInfoLayer == null) {\r\n            this.roomInfoLayer =this.node.getChildByName('21dian-box').getComponent('roominfo');\r\n            this.roomInfoLayer.loadInfo({\r\n                roomIndex: this.roomIndex,\r\n                left: 416,\r\n            })\r\n        }\r\n\r\n    },\r\n    // 显示下注层信息\r\n    loadUILayer: function(){\r\n\r\n        this.buttonLayer= this.button_list.getComponent('betbutton')\r\n        this.buttonLayer.loadInfo(this)\r\n    },\r\n\r\n\r\n    /**\r\n     * 游戏消息事件\r\n     * @param subCMD 子游戏命令\r\n     * @param data 数据\r\n     * @returns {boolean}\r\n     */\r\n    //正在下注的处理函数\r\n    onWageringHandler(data){\r\n        if (data.leftTime >= 5000) {\r\n            // 开始提示精灵进场\r\n            this.startSprIn();\r\n        }\r\n        // 重新设置玩家\r\n        // this.resetPlayer();\r\n        // 显示下注层\r\n        if (this.buttonLayer == null) {\r\n            this.loadUILayer();\r\n        }\r\n        this.buttonLayer.showBetLayer(data, this.getMyPlayerScore());\r\n    },\r\n    // 下注的处理函数\r\n    onWagerHandler: function(data){\r\n\r\n        var myUserItem = GD.clientKernel.myUserItem;\r\n        var wagerP = this.findPlayerByID(data.userID);\r\n\r\n        if (wagerP) {\r\n            // 设置底注\r\n            wagerP.setBaseBet(data.betNum);\r\n            // 下注的处理函数\r\n\r\n            wagerP.onWagerHandler(data);\r\n\r\n        }\r\n\r\n        if (data.userID == myUserItem.userID) {\r\n            this.isGameStarted = true;\r\n        }\r\n    },\r\n    // 发牌的处理函数\r\n    onDealHandler: function(data){\r\n        var count = 0;\r\n        var allPlayerCurCards = data.allPlayerCurCards;\r\n        this.hideProgressTimer();\r\n        for (var j = 0, lenJ = this.players.length; j < lenJ; j++) {\r\n            var playerSpr = this.players[j];\r\n            if (playerSpr == null) continue;\r\n\r\n            count++;\r\n            for (var i = 0, lenI = allPlayerCurCards.length; i < lenI; i++) {\r\n                var cardData = allPlayerCurCards[i];\r\n                if (cardData.id == playerSpr.getUserID()) {\r\n                    // 间隔发牌\r\n                    this.delayDeal(playerSpr, cardData, count, data.dealID);\r\n                    playerSpr.setIsPlaying(true);\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n        //\r\n        this.roomInfoLayer.updateCardNum(data.cardLeftNum);\r\n        // 隐藏下注层\r\n        this.buttonLayer.setBetLayerVisible(false);\r\n    },\r\n    // 下一个玩家行动\r\n    onNextActionHandler:function(data){\r\n        // data: {userID:, doneCount:, canSplit:, canDouble:}\r\n        var myUserItem = GD.clientKernel.myUserItem;\r\n        if (data.userID == myUserItem.userID) {\r\n            this.buttonLayer.showOperateLayer();\r\n            this.buttonLayer.setSplitAndDouble(data.canSplit, data.canDouble);\r\n        }\r\n\r\n        for (var i = 0, lenI = this.players.length; i < lenI; i++) {\r\n            var player = this.players[i];\r\n            player && player.setHitTipVisible(data.selfKey, player.getUserID() == data.userID);\r\n        }\r\n    },\r\n    // 提示保险的处理函数\r\n    onInsuranceHandler: function(data){\r\n        var myUserItem = GD.clientKernel.myUserItem;\r\n        var betNum = data.betNum;\r\n\r\n        for (var i = 0, lenI = this.players.length; i < lenI; i++) {\r\n            var player = this.players[i];\r\n            if (player == null) continue;\r\n\r\n            var isPlaying = player.isPlaying();\r\n            if (isPlaying && !player.isDealer()) {\r\n                if (myUserItem.userID == player.getUserID()) {\r\n                    this.insuranceLayer = new InsuranceLayer(\r\n                        this.onCloseInsuranceLayer.bind(this), betNum\r\n                    ).to(this, 2);\r\n                }\r\n                player.showProgressTimer();\r\n            }\r\n        }\r\n    },\r\n    // 买保险的处理函数\r\n    onBuyInsuranceHandler: function(data){\r\n        var curPlayer = this.findPlayerByID(data.userID);\r\n        curPlayer.onBuyInsuranceHandler(data);\r\n        SoundEngine.playEffect(\"res/21dian/sound/Insurance.mp3\");\r\n    },\r\n    // 关闭强制退出提示\r\n    onCloseInsuranceLayer: function(type){\r\n        if (this.insuranceLayer) {\r\n            if (type == this.insuranceLayer.TYPE_YES) {\r\n                GD.gameEngine.sendInsuranceMessage(subGameMSG.TYPE_INSURANCE, {flag: type});\r\n            }\r\n            this.insuranceLayer.removeFromParent();\r\n            this.insuranceLayer = null;\r\n        }\r\n    },\r\n    // 要牌的处理函数\r\n    onHitHandler: function(data){\r\n        // data: {selfKey: ,userID: ,card: ,canDouble: ,canSplit: ,isDouble: ,curCards: ,score:}\r\n        var myUserItem = GD.clientKernel.myUserItem;\r\n        var result = data.curCards.result;\r\n        var curPlayer = this.findPlayerByID(data.userID);\r\n        curPlayer.onHitHandler(data, false);\r\n        //\r\n        this.roomInfoLayer.updateCardNum(data.cardLeftNum);\r\n        if (myUserItem.userID == data.userID) {\r\n            // 恢复操作按钮\r\n            if (!data.isDouble && !result.isBust && !result.isFiveDragon) {\r\n                this.buttonLayer.setOperateButtonsOpacity(255);\r\n                this.buttonLayer.setSplitAndDouble(data.canSplit, data.canDouble);\r\n            } else {\r\n                this.buttonLayer.setOperateLayerVisible(false);\r\n            }\r\n        }\r\n    },\r\n    // 隐藏进度条\r\n    hideProgressTimer: function(){\r\n        for (var i = 0, lenI = this.players.length; i < lenI; i++) {\r\n            var player = this.players[i];\r\n            player && player.hideProgressTimer();\r\n        }\r\n    },\r\n    //获取我的分数\r\n    getMyPlayerScore: function(){\r\n        var myUserItem = GD.clientKernel.myUserItem;\r\n        if (myUserItem) {\r\n            var player = this.findPlayerByID(myUserItem.userID);\r\n            return player.getCurScore();\r\n        }\r\n        return null\r\n    },\r\n    // 根据ID获取玩家对象\r\n    findPlayerByID(userID){\r\n        for (var i = 0, len = this.players.length; i < len; i++) {\r\n            var playerSpr = this.players[i];\r\n            if (playerSpr && playerSpr.getUserID() == userID) {\r\n                return playerSpr;\r\n            }\r\n        }\r\n\r\n        return null;\r\n    },\r\n    onEventGameMessage(subCMD, data) {\r\n\r\n        switch (subCMD) {\r\n            case subGameMSG.TYPE_WAGERING:\r\n                this.onWageringHandler(data);\r\n                break;\r\n\r\n            case subGameMSG.TYPE_WAGER:\r\n                this.onWagerHandler(data);\r\n                break;\r\n            case subGameMSG.TYPE_DEAL:\r\n                this.onDealHandler(data);\r\n                break;\r\n\r\n\r\n            case subGameMSG.TYPE_NEXT_ACTION:\r\n                this.onNextActionHandler(data);\r\n                break;\r\n\r\n            // case subGameMSG.TYPE_HIT:\r\n            //     this.onHitHandler(data);\r\n            //     break;\r\n            //\r\n            // case subGameMSG.TYPE_STAND:\r\n            //     this.onStandHandler(data);\r\n            //     break;\r\n            //\r\n            // case subGameMSG.TYPE_BUST:\r\n            //     this.onBustHandler(data);\r\n            //     break;\r\n            //\r\n            // case subGameMSG.TYPE_SPLIT:\r\n            //     this.onSplitHandler(data);\r\n            //     break;\r\n            //\r\n            // case subGameMSG.TYPE_GAME_OVER:\r\n            //     this.onGameOverHandler(data);\r\n            //     break;\r\n            //\r\n            case subGameMSG.TYPE_INSURANCE:\r\n                this.onInsuranceHandler(data);\r\n                break;\r\n\r\n            // case subGameMSG.TYPE_BUY_INSURANCE:\r\n            //     this.onBuyInsuranceHandler(data);\r\n            //     break;\r\n            //\r\n            // case subGameMSG.TYPE_IS_BLACK_JACK:\r\n            //     this.onIsBlackJackHandler(data);\r\n            //     break;\r\n            //\r\n            // case subGameMSG.TYPE_DEAL_TURN:\r\n            //     this.onDealTurnHandler(data);\r\n            //     break;\r\n            //\r\n            // case subGameMSG.NOT_ENOUGH_MONEY:\r\n            //     this.onNotMoneyHandler(data);\r\n            //     break;\r\n            //\r\n            // default :\r\n            //     return true;\r\n        }\r\n    },\r\n\r\n\r\n\r\n\r\n});"]}