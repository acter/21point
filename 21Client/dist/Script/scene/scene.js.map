{"version":3,"sources":["../../../Script/scene/scene.js"],"names":["NetHelp","require","subGameMSG","ClientKernel","GD","Player","define","gameCMD","Betbutton","gameEvent","gameConst","ZZConfig","betButton","cc","Class","properties","userPreb","default","type","Prefab","goldPreb","Allsprite","SpriteAtlas","extends","Component","onLoad","MAX_BET","players","roomIndex","isGameStarted","startSpr","loadStartTip","gameResultLayer","curBet","bindEvent","initMembers","lastBetNum","initNodes","i","num","bindObj","push","onfire","on","onEventSceneMessage","bind","onEventGameMessage","size","winSize","x","width","Node","sp","addComponent","Sprite","spriteFrame","_spriteFrames","parent","node","setPosition","startSprIn","runAction","sequence","moveTo","p","easing","easeBackOut","delayTime","easeBackIn","callFunc","onWageringHandler","data","leftTime","loadUILayer","onWagerHandler","myUserItem","clientKernel","wagerP","findPlayerByID","userID","setBaseBet","betNum","resetPlayer","len","length","player","reset","isDealer","showProgressTimer","bet_list","active","card_handle","getChildByName","gameStatus","isGameOver","playerData","curData","chairID","playSit","showTip","isWagering","log","timeLeft","roomInfo","betbutton","delayDeal","playerSpr","dealID","cards","setTimeout","loadCardBoxes","playChair","playerPos","newPlayer","instantiate","templayer","script","getComponent","addChild","loadInfo","bet_btn","children","bet_num","Label","string","onButtonHandler","btn","target","TYPE_BTN_MAX","onMaxButtonHandler","TYPE_BTN_LAST","onLastButtonHandler","TYPE_BTN_HELP","onHelpButtonHandler","TYPE_BTN_FIRST","TYPE_BTN_SECOND","TYPE_BTN_THIRD","TYPE_BTN_FOURTH","TYPE_BTN_FIFTH","onBetButtonHandler","TYPE_BTN_SPLIT","TYPE_BTN_DOUBLE","TYPE_BTN_STAND","TYPE_BTN_HIT","onOperateButtonHandler","getMyPlayerScore","getCurScore","getUserID","subCMD","TYPE_WAGERING","TYPE_WAGER","TYPE_DEAL","onDealHandler","TYPE_NEXT_ACTION","onNextActionHandler","TYPE_HIT","onHitHandler","TYPE_STAND","onStandHandler","TYPE_BUST","onBustHandler","TYPE_SPLIT","onSplitHandler","TYPE_GAME_OVER","onGameOverHandler","TYPE_INSURANCE","onInsuranceHandler","TYPE_BUY_INSURANCE","onBuyInsuranceHandler","TYPE_IS_BLACK_JACK","onIsBlackJackHandler","TYPE_DEAL_TURN","onDealTurnHandler","NOT_ENOUGH_MONEY","onNotMoneyHandler","sendGameData","sendSocketData","MDM_GF_GAME"],"mappings":"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","file":"scene.js","sourcesContent":["var NetHelp = require(\"NetHelp\")\r\nvar subGameMSG = require(\"SubGameMSG\").subGameMSG\r\nvar ClientKernel = require(\"ClientKernel\")\r\nvar GD = require(\"GD\")\r\nvar Player = require('player')\r\nvar define = require('define');\r\nvar gameCMD = define.gameCMD;\r\nvar Betbutton = require('betbutton')\r\nvar gameEvent = define.gameEvent;\r\nvar gameConst = define.gameConst;\r\nvar ZZConfig = require(\"Config\").ZZConfig\r\nvar betButton = require('betbutton')\r\n\r\ncc.Class({\r\n    properties:{\r\n        userPreb:{\r\n            default:null,\r\n            type:cc.Prefab\r\n        },\r\n        goldPreb:{\r\n            default:null,\r\n            type:cc.Prefab\r\n        },\r\n        Allsprite:{\r\n            default:null,\r\n            type:cc.SpriteAtlas\r\n        }\r\n    },\r\n    extends: cc.Component,\r\n    onLoad:function(){\r\n\r\n        this.MAX_BET = 2000;//下注上限\r\n        this.players = [];\r\n        this.roomIndex = 0;\r\n        this.isGameStarted = false;\r\n        this.startSpr = null;\r\n        // 加载开始提示\r\n        this.loadStartTip();\r\n        this.gameResultLayer = null;\r\n        this.curBet = 0;\r\n        this.bindEvent();\r\n        this.initMembers()\r\n        this.lastBetNum = 0;//上次下注数\r\n        this.initNodes()\r\n\r\n    },\r\n    // 初始化成员变量\r\n    initMembers: function(){\r\n        // 初始化出6个空位置。五个玩家、一个庄家\r\n        for (var i = 0, num = 6; i < num; i++) {\r\n            this.players[i] = null;\r\n        }\r\n    },\r\n    bindEvent() {\r\n        this.bindObj = []\r\n        this.bindObj.push(onfire.on(\"onEventSceneMessage\", this.onEventSceneMessage.bind(this)))\r\n        this.bindObj.push(onfire.on(\"onEventGameMessage\", this.onEventGameMessage.bind(this)))\r\n    },\r\n\r\n    loadStartTip(){\r\n        var size  = cc.winSize;\r\n        var x = size.width;\r\n        // var y = size.height * 0.6;\r\n        this.startSpr = new cc.Node('startBet');\r\n        var sp = this.startSpr.addComponent(cc.Sprite);\r\n\r\n        sp.spriteFrame = this.Allsprite._spriteFrames['21dian-start'];\r\n        this.startSpr.parent = this.node;\r\n        this.startSpr.setPosition(-x,0);\r\n    },\r\n    startSprIn: function(){\r\n        // 开始提示精灵进场\r\n        if (this.startSpr == null) return;\r\n        var size  = cc.winSize;\r\n        var x = size.width * 0.5;\r\n\r\n        this.startSpr.runAction(cc.sequence(\r\n            cc.moveTo(0.5, cc.p(0, 0)).easing(cc.easeBackOut(0.5)),\r\n            cc.delayTime(0.5),\r\n            cc.moveTo(0.5,cc.p(2.5 * x, 0)).easing(cc.easeBackIn(0.5)),\r\n            cc.callFunc(function(){\r\n                this.startSpr.setPosition(-x,0);\r\n            }.bind(this))\r\n        ));\r\n    },\r\n    // 正在下注的处理函数\r\n    onWageringHandler(data){\r\n        if (data.leftTime >= 5000) {\r\n            // 开始提示精灵进场\r\n            this.startSprIn();\r\n        }\r\n        // 重新设置玩家\r\n        // this.resetPlayer();\r\n        //加载下注层\r\n        this.loadUILayer();\r\n\r\n    },\r\n    //下注的处理函数\r\n    onWagerHandler(data){\r\n        var myUserItem = GD.clientKernel.myUserItem;\r\n        var wagerP = this.findPlayerByID(data.userID);\r\n\r\n        if (wagerP) {\r\n            // 设置底注\r\n            wagerP.setBaseBet(data.betNum);\r\n            // 下注的处理函数\r\n            wagerP.onWagerHandler(data);\r\n        }\r\n\r\n        if (data.userID == myUserItem.userID) {\r\n            this.isGameStarted = true;\r\n        }\r\n    },\r\n    // 重新设置玩家\r\n    resetPlayer: function(){\r\n        for (var i = 0, len = this.players.length; i < len; i++) {\r\n            var player = this.players[i];\r\n            if (player) {\r\n                if (player == null) return;\r\n                // 重置数据\r\n                player.reset();\r\n                // 不是庄家才显示数秒框\r\n                !player.isDealer() && player.showProgressTimer();\r\n            }\r\n        }\r\n    },\r\n    //加载下注层,隐藏操作层\r\n    loadUILayer() {\r\n        this.bet_list.active = true;\r\n        this.card_handle = this.node.getChildByName('card_handle')\r\n        this.card_handle.active = false;\r\n    },\r\n    /*\r\n  * 逻辑处理\r\n  * */\r\n    // 场景还原\r\n    onEventSceneMessage(gameStatus,data){\r\n        // data: {playerData: ,dealID: ,isGameOver: ,cardLeftNum: ,\r\n        // timeLeft: ,isWagering: ,roomIndex:}\r\n\r\n        var myUserItem = GD.clientKernel.myUserItem;\r\n        var isGameOver = data.isGameOver;\r\n        var playerData = data.playerData;\r\n        this.roomIndex = data.roomIndex;\r\n\r\n\r\n        for (var i = 0, len = playerData.length; i < len; i++) {\r\n            var curData = playerData[i];\r\n            var chairID = curData.chairID;\r\n            //各个玩家坐下\r\n            var player =  this.playSit(chairID,curData);\r\n\r\n            // // 提示玩家所在位置\r\n            if (curData.userID == myUserItem.userID) {\r\n\r\n                player.showTip();\r\n            }\r\n            if (!isGameOver) {\r\n                // 间隔发牌\r\n                // this.delayDeal(playerSpr, curData, i, data.dealID);\r\n                if (data.isWagering) {\r\n                    // this.delayDeal(player, curData, i, data.dealID);\r\n                    cc.log('开始下注时间',data.timeLeft)\r\n                    player.showProgressTimer(data.timeLeft);\r\n                }\r\n            }\r\n            this.players[chairID] = player;\r\n\r\n        }\r\n\r\n        // 更新卡牌数量\r\n        this.roomInfo(this.roomIndex)\r\n        // && this.roomInfoLayer.updateCardNum(data.cardLeftNum);\r\n    },\r\n    roomInfo(roomIndex){\r\n        this.betbutton = new betButton(roomIndex);\r\n    },\r\n    // 延迟发牌\r\n    delayDeal: function(playerSpr, curData, i, dealID){\r\n        if (curData.cards) {\r\n            setTimeout(function(){\r\n                playerSpr.loadCardBoxes(curData.cards, dealID);\r\n            }, 600 * i);\r\n        }\r\n    },\r\n    //玩家坐下\r\n    playSit(chairID,data){\r\n        if(data.isDealer){\r\n            this.playChair = this.playerPos.getChildByName('pos5')\r\n        }\r\n            this.playChair = this.playerPos.getChildByName('pos'+chairID)\r\n            var newPlayer = cc.instantiate(this.userPreb);\r\n            let templayer= newPlayer.addComponent(Player);\r\n            var script = newPlayer.getComponent('player')\r\n            this.playChair.addChild(newPlayer);\r\n            this.playChair.active = true;\r\n            script.loadInfo(data,this.Allsprite)\r\n\r\n            //\r\n            return script;\r\n        // }\r\n\r\n    },\r\n    initNodes(){\r\n        this.bet_btn= [];\r\n        // 常量\r\n        this.playerPos = this.node.getChildByName('21dian-player');\r\n        this.bet_list = this.node.getChildByName('bet_btn_list')\r\n        //监听是否下注时间结束\r\n        // onfire.on('readyEnd',this.readyEnd.bind(this))\r\n        for(var i = 0; i < this.bet_list.children.length;i++){\r\n            this.bet_btn[i] = this.bet_list.children[i];\r\n\r\n            //下注金币\r\n\r\n            var bet_num =  this.bet_btn[i].children[0].getComponent(cc.Label).string;\r\n            this.bet_btn[i].type = i;\r\n            this.bet_btn[i].betNum = bet_num;\r\n            this.bet_btn[i].on('touchend',this.onButtonHandler.bind(this))\r\n\r\n        }\r\n\r\n    },\r\n    // 点击按钮的处理函数\r\n    onButtonHandler(btn){\r\n        var betButton = this.bet_list.getComponent('betbutton','aaaa');\r\n        switch (btn.target.type){\r\n            case betButton.TYPE_BTN_MAX:\r\n                betButton.onMaxButtonHandler(btn);\r\n                break;\r\n\r\n            case betButton.TYPE_BTN_LAST:\r\n                betButton.onLastButtonHandler(btn);\r\n\r\n                break;\r\n\r\n            case this.TYPE_BTN_HELP:\r\n                betButton.onHelpButtonHandler(btn);\r\n                break;\r\n\r\n            case this.TYPE_BTN_FIRST:\r\n            case this.TYPE_BTN_SECOND:\r\n            case this.TYPE_BTN_THIRD:\r\n            case this.TYPE_BTN_FOURTH:\r\n            case this.TYPE_BTN_FIFTH:\r\n                betButton.onBetButtonHandler(btn);\r\n                break;\r\n            case this.TYPE_BTN_SPLIT:\r\n            case this.TYPE_BTN_DOUBLE:\r\n            case this.TYPE_BTN_STAND:\r\n            case this.TYPE_BTN_HIT:\r\n                betButton.onOperateButtonHandler(btn);\r\n                break;\r\n        }\r\n    },\r\n    //获取得分\r\n    getMyPlayerScore: function(){\r\n        var myUserItem = GD.clientKernel.myUserItem;\r\n        if (myUserItem) {\r\n            var player = this.findPlayerByID(myUserItem.userID);\r\n            return player.getCurScore();\r\n        }\r\n        return null\r\n    },\r\n// 根据ID获取玩家对象\r\n    findPlayerByID(userID){\r\n        for (var i = 0, len = this.players.length; i < len; i++) {\r\n            var playerSpr = this.players[i];\r\n            if (playerSpr && playerSpr.getUserID() == userID) {\r\n                return playerSpr;\r\n            }\r\n        }\r\n\r\n        return null;\r\n    },\r\n    /**\r\n     * 游戏消息事件\r\n     * @param subCMD 子游戏命令\r\n     * @param data 数据\r\n     * @returns {boolean}\r\n     */\r\n    onEventGameMessage(subCMD, data) {\r\n\r\n        switch (subCMD) {\r\n            case subGameMSG.TYPE_WAGERING:\r\n                this.onWageringHandler(data);\r\n                break;\r\n\r\n            case subGameMSG.TYPE_WAGER:\r\n                this.onWagerHandler(data);\r\n                break;\r\n\r\n            case subGameMSG.TYPE_DEAL:\r\n                this.onDealHandler(data);\r\n                break;\r\n\r\n            case subGameMSG.TYPE_NEXT_ACTION:\r\n                this.onNextActionHandler(data);\r\n                break;\r\n\r\n            case subGameMSG.TYPE_HIT:\r\n                this.onHitHandler(data);\r\n                break;\r\n\r\n            case subGameMSG.TYPE_STAND:\r\n                this.onStandHandler(data);\r\n                break;\r\n\r\n            case subGameMSG.TYPE_BUST:\r\n                this.onBustHandler(data);\r\n                break;\r\n\r\n            case subGameMSG.TYPE_SPLIT:\r\n                this.onSplitHandler(data);\r\n                break;\r\n\r\n            case subGameMSG.TYPE_GAME_OVER:\r\n                this.onGameOverHandler(data);\r\n                break;\r\n\r\n            case subGameMSG.TYPE_INSURANCE:\r\n                this.onInsuranceHandler(data);\r\n                break;\r\n\r\n            case subGameMSG.TYPE_BUY_INSURANCE:\r\n                this.onBuyInsuranceHandler(data);\r\n                break;\r\n\r\n            case subGameMSG.TYPE_IS_BLACK_JACK:\r\n                this.onIsBlackJackHandler(data);\r\n                break;\r\n\r\n            case subGameMSG.TYPE_DEAL_TURN:\r\n                this.onDealTurnHandler(data);\r\n                break;\r\n\r\n            case subGameMSG.NOT_ENOUGH_MONEY:\r\n                this.onNotMoneyHandler(data);\r\n                break;\r\n\r\n            default :\r\n                return true;\r\n        }\r\n    },\r\n    //发送子游戏事件\r\n\r\n    sendGameData: function(subCMD, data) {\r\n        GD.clientKernel.sendSocketData(gameCMD.MDM_GF_GAME, subCMD, data);\r\n    },\r\n\r\n\r\n});"]}